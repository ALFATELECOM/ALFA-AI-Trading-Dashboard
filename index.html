<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlgoTrade Pro - Complete Algorithmic Trading Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06d6a0;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --light-bg: #f8fafc;
            --card-bg: #ffffff;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --border-color: #e2e8f0;
            --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --success-gradient: linear-gradient(135deg, var(--success-color), var(--accent-color));
            --danger-gradient: linear-gradient(135deg, var(--danger-color), #dc2626);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--light-bg);
            overflow-x: hidden;
        }

        body.dark-mode {
            --light-bg: #0f172a;
            --card-bg: #1e293b;
            --text-dark: #f1f5f9;
            --text-light: #94a3b8;
            --border-color: #334155;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 70px 1fr;
            height: 100vh;
            grid-template-areas: 
                "sidebar header"
                "sidebar content";
        }

        /* Header */
        .header {
            grid-area: header;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 15px 8px 40px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            width: 300px;
            font-size: 14px;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        /* Sidebar */
        .sidebar {
            grid-area: sidebar;
            background: var(--card-bg);
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .logo h2 {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--text-dark);
            text-decoration: none;
            transition: all 0.3s ease;
            border-right: 3px solid transparent;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(99, 102, 241, 0.1);
            border-right-color: var(--primary-color);
            color: var(--primary-color);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        /* Content Area */
        .content {
            grid-area: content;
            padding: 30px;
            overflow-y: auto;
            background: var(--light-bg);
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        /* Strategy Builder */
        .strategy-builder {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            height: 600px;
        }

        .components-panel {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }

        .canvas-area {
            background: var(--card-bg);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 2px dashed var(--border-color);
        }

        .properties-panel {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }

        .component-item {
            padding: 10px;
            margin: 5px 0;
            background: var(--light-bg);
            border-radius: 6px;
            cursor: move;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .component-item:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--primary-color);
        }

        /* Charts */
        .chart-container {
            height: 400px;
            background: var(--card-bg);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            border: 1px solid var(--border-color);
        }

        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: var(--light-bg);
            font-weight: 600;
            color: var(--text-dark);
        }

        .table tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        /* Status Indicators */
        .status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.running {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
        }

        .status.stopped {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
        }

        .status.paused {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg);
            margin: 5% auto;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: var(--text-light);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: var(--text-dark);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: var(--light-bg);
            padding: 5px;
            border-radius: 10px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-dark);
        }

        .tab-btn.active {
            background: var(--card-bg);
            color: var(--primary-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Metrics Cards */
        .metric-card {
            text-align: center;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .metric-change {
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .positive {
            color: var(--success-color);
        }

        .negative {
            color: var(--danger-color);
        }

        /* Code Editor */
        .code-editor {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            min-height: 300px;
            border: 1px solid var(--border-color);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-in {
            animation: slideIn 0.3s ease;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 250px 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "content";
            }
            
            .sidebar {
                display: none;
            }
            
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .strategy-builder {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                height: auto;
            }
        }

        /* Page-specific styles */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Dark mode toggle */
        .theme-toggle {
            background: none;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Notification system */
        .notifications {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
        }

        .notification {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            max-width: 350px;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            border-left: 4px solid var(--success-color);
        }

        .notification.error {
            border-left: 4px solid var(--danger-color);
        }

        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }
    </style>
</head>
<body>
    <div class="main-layout">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search strategies, symbols, or commands...">
                </div>
            </div>
            <div class="header-right">
                <span id="system-status" class="status running">SYSTEM ONLINE</span>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="user-profile">
                    <i class="fas fa-user-circle" style="font-size: 1.5rem; color: var(--primary-color);"></i>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h2><i class="fas fa-chart-line"></i> AlgoTrade Pro</h2>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active" onclick="showPage('dashboard')">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#strategy-builder" class="nav-link" onclick="showPage('strategy-builder')">
                            <i class="fas fa-code-branch"></i>
                            <span>Strategy Builder</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#backtesting" class="nav-link" onclick="showPage('backtesting')">
                            <i class="fas fa-history"></i>
                            <span>Backtesting</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#live-trading" class="nav-link" onclick="showPage('live-trading')">
                            <i class="fas fa-bolt"></i>
                            <span>Live Trading</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#portfolio" class="nav-link" onclick="showPage('portfolio')">
                            <i class="fas fa-briefcase"></i>
                            <span>Portfolio</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#risk-management" class="nav-link" onclick="showPage('risk-management')">
                            <i class="fas fa-shield-alt"></i>
                            <span>Risk Management</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#market-data" class="nav-link" onclick="showPage('market-data')">
                            <i class="fas fa-chart-bar"></i>
                            <span>Market Data</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#research" class="nav-link" onclick="showPage('research')">
                            <i class="fas fa-flask"></i>
                            <span>Research Lab</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#optimization" class="nav-link" onclick="showPage('optimization')">
                            <i class="fas fa-cogs"></i>
                            <span>Optimization</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#alerts" class="nav-link" onclick="showPage('alerts')">
                            <i class="fas fa-bell"></i>
                            <span>Alerts & Signals</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#analytics" class="nav-link" onclick="showPage('analytics')">
                            <i class="fas fa-analytics"></i>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#paper-trading" class="nav-link" onclick="showPage('paper-trading')">
                            <i class="fas fa-file-alt"></i>
                            <span>Paper Trading</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#options-trading" class="nav-link" onclick="showPage('options-trading')">
                            <i class="fas fa-chart-pie"></i>
                            <span>Options Trading</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#trade-reports" class="nav-link" onclick="showPage('trade-reports')">
                            <i class="fas fa-file-invoice"></i>
                            <span>Trade Reports</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#broker-integration" class="nav-link" onclick="showPage('broker-integration')">
                            <i class="fas fa-plug"></i>
                            <span>Broker Integration</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#settings" class="nav-link" onclick="showPage('settings')">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h1 class="page-title">Trading Dashboard</h1>
                    <div>
                        <button class="btn btn-primary" onclick="showModal('quick-strategy-modal')">
                            <i class="fas fa-plus"></i> Quick Strategy
                        </button>
                        <button class="btn btn-success" onclick="startAllStrategies()">
                            <i class="fas fa-play"></i> Start All
                        </button>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="grid-4" style="margin-bottom: 30px;">
                    <div class="metric-card">
                        <div class="metric-value positive" id="total-pnl">+₹45,680</div>
                        <div class="metric-label">Total P&L</div>
                        <div class="metric-change positive">+12.4% today</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--primary-color);" id="active-strategies">8</div>
                        <div class="metric-label">Active Strategies</div>
                        <div class="metric-change">2 optimizing</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--warning-color);" id="risk-exposure">68%</div>
                        <div class="metric-label">Risk Exposure</div>
                        <div class="metric-change">Within limits</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value positive" id="win-rate">84.2%</div>
                        <div class="metric-label">Win Rate</div>
                        <div class="metric-change positive">+2.1% this week</div>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- Active Strategies -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Active Strategies</h3>
                            <button class="btn btn-sm btn-secondary" onclick="refreshStrategies()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                        <div id="strategies-list">
                            <!-- Strategies will be populated here -->
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Portfolio Performance</h3>
                            <div class="tabs" style="width: auto; margin: 0;">
                                <button class="tab-btn active" onclick="updateChart('1D')">1D</button>
                                <button class="tab-btn" onclick="updateChart('1W')">1W</button>
                                <button class="tab-btn" onclick="updateChart('1M')">1M</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <div>Interactive Performance Chart</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Trades -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Trades</h3>
                        <button class="btn btn-sm btn-primary" onclick="showModal('trade-details-modal')">
                            <i class="fas fa-list"></i> View All
                        </button>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Strategy</th>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>P&L</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recent-trades">
                            <!-- Trades will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Strategy Builder Page -->
            <div id="strategy-builder" class="page">
                <div class="page-header">
                    <h1 class="page-title">Strategy Builder</h1>
                    <div>
                        <button class="btn btn-secondary" onclick="loadTemplate()">
                            <i class="fas fa-file-import"></i> Load Template
                        </button>
                        <button class="btn btn-primary" onclick="saveStrategy()">
                            <i class="fas fa-save"></i> Save Strategy
                        </button>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" onclick="showBuilderTab('visual')">Visual Builder</button>
                    <button class="tab-btn" onclick="showBuilderTab('code')">Code Editor</button>
                    <button class="tab-btn" onclick="showBuilderTab('templates')">Templates</button>
                </div>

                <!-- Visual Builder -->
                <div id="visual-builder" class="tab-content active">
                    <div class="strategy-builder">
                        <div class="components-panel">
                            <h4>Components</h4>
                            
                            <div style="margin-bottom: 20px;">
                                <h5>Indicators</h5>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-chart-line"></i> Moving Average
                                </div>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-wave-square"></i> RSI
                                </div>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-chart-area"></i> MACD
                                </div>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-signal"></i> Bollinger Bands
                                </div>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <h5>Conditions</h5>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-greater-than"></i> Price Above
                                </div>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-less-than"></i> Price Below
                                </div>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-arrows-alt-h"></i> Crossover
                                </div>
                            </div>

                            <div>
                                <h5>Actions</h5>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-arrow-up"></i> Buy Order
                                </div>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-arrow-down"></i> Sell Order
                                </div>
                                <div class="component-item" draggable="true">
                                    <i class="fas fa-shield-alt"></i> Stop Loss
                                </div>
                            </div>
                        </div>

                        <div class="canvas-area">
                            <div style="text-align: center; margin-top: 200px; color: var(--text-light);">
                                <i class="fas fa-mouse-pointer" style="font-size: 3rem; margin-bottom: 15px;"></i>
                                <div>Drag and drop components here to build your strategy</div>
                            </div>
                        </div>

                        <div class="properties-panel">
                            <h4>Properties</h4>
                            <div id="component-properties">
                                <p style="color: var(--text-light); text-align: center; margin-top: 50px;">
                                    Select a component to edit its properties
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Code Editor -->
                <div id="code-editor" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Python Strategy Code</h3>
                            <div>
                                <button class="btn btn-sm btn-secondary">
                                    <i class="fas fa-play"></i> Test
                                </button>
                                <button class="btn btn-sm btn-primary">
                                    <i class="fas fa-check"></i> Compile
                                </button>
                            </div>
                        </div>
                        <div class="code-editor">
<pre># AlgoTrade Pro Strategy Template
import pandas as pd
import numpy as np
from algotrade import Strategy, Indicator

class MyStrategy(Strategy):
    def __init__(self):
        self.sma_fast = Indicator.SMA(period=10)
        self.sma_slow = Indicator.SMA(period=30)
        self.rsi = Indicator.RSI(period=14)
    
    def on_data(self, data):
        # Entry Conditions
        if (self.sma_fast.value > self.sma_slow.value and 
            self.rsi.value < 70 and 
            not self.position.is_long):
            
            self.buy(size=100, stop_loss=0.02, take_profit=0.05)
        
        # Exit Conditions
        elif (self.sma_fast.value < self.sma_slow.value and 
              self.position.is_long):
            
            self.sell_all()
    
    def on_order_filled(self, order):
        self.log(f"Order filled: {order}")
</pre>
                        </div>
                    </div>
                </div>

                <!-- Templates -->
                <div id="templates" class="tab-content">
                    <div class="grid-3">
                        <div class="card">
                            <h4>Momentum Strategy</h4>
                            <p>Trend-following strategy using moving averages and momentum indicators.</p>
                            <div style="margin: 15px 0;">
                                <span class="status running">Tested</span>
                                <span style="margin-left: 10px; color: var(--success-color);">Win Rate: 72%</span>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="loadStrategyTemplate('momentum')">Load Template</button>
                        </div>
                        
                        <div class="card">
                            <h4>Mean Reversion</h4>
                            <p>Counter-trend strategy using Bollinger Bands and RSI oversold/overbought levels.</p>
                            <div style="margin: 15px 0;">
                                <span class="status running">Tested</span>
                                <span style="margin-left: 10px; color: var(--success-color);">Win Rate: 68%</span>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="loadStrategyTemplate('mean-reversion')">Load Template</button>
                        </div>
                        
                        <div class="card">
                            <h4>Arbitrage</h4>
                            <p>Statistical arbitrage strategy exploiting price differences across markets.</p>
                            <div style="margin: 15px 0;">
                                <span class="status running">Tested</span>
                                <span style="margin-left: 10px; color: var(--success-color);">Win Rate: 89%</span>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="loadStrategyTemplate('arbitrage')">Load Template</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backtesting Page -->
            <div id="backtesting" class="page">
                <div class="page-header">
                    <h1 class="page-title">Strategy Backtesting</h1>
                    <button class="btn btn-primary" onclick="runBacktest()">
                        <i class="fas fa-play"></i> Run Backtest
                    </button>
                </div>

                <div class="grid-2">
                    <!-- Backtest Configuration -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Backtest Configuration</h3>
                        </div>
                        <div class="form-group">
                            <label>Strategy</label>
                            <select>
                                <option>Momentum Strategy v2.1</option>
                                <option>Mean Reversion Pro</option>
                                <option>Arbitrage Master</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date Range</label>
                            <div class="grid-2">
                                <input type="date" value="2023-01-01">
                                <input type="date" value="2024-01-01">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Initial Capital</label>
                            <input type="number" value="100000" placeholder="₹100,000">
                        </div>
                        <div class="form-group">
                            <label>Commission</label>
                            <input type="number" value="0.01" step="0.01" placeholder="0.01%">
                        </div>
                        <div class="form-group">
                            <label>Slippage</label>
                            <input type="number" value="0.05" step="0.01" placeholder="0.05%">
                        </div>
                    </div>

                    <!-- Backtest Results -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Backtest Results</h3>
                        </div>
                        <div class="grid-2">
                            <div class="metric-card">
                                <div class="metric-value positive">+₹45,680</div>
                                <div class="metric-label">Total Return</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">2.34</div>
                                <div class="metric-label">Sharpe Ratio</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value negative">-12.5%</div>
                                <div class="metric-label">Max Drawdown</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">68.4%</div>
                                <div class="metric-label">Win Rate</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equity Curve -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Equity Curve</h3>
                    </div>
                    <div class="chart-container">
                        <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <div>Equity Curve Chart</div>
                    </div>
                </div>

                <!-- Trade Analysis -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Trade Analysis</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Quantity</th>
                                <th>P&L</th>
                                <th>Return %</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2024-01-15</td>
                                <td>RELIANCE</td>
                                <td>Long</td>
                                <td>₹2,450</td>
                                <td>₹2,520</td>
                                <td>100</td>
                                <td class="positive">+₹7,000</td>
                                <td class="positive">+2.86%</td>
                            </tr>
                            <!-- More trades... -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Live Trading Page -->
            <div id="live-trading" class="page">
                <div class="page-header">
                    <h1 class="page-title">Live Trading</h1>
                    <div>
                        <span class="status running pulse">MARKET OPEN</span>
                        <button class="btn btn-danger" onclick="emergencyStop()">
                            <i class="fas fa-stop"></i> Emergency Stop
                        </button>
                    </div>
                </div>

                <div class="grid-3">
                    <!-- Strategy Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Strategy Status</h3>
                        </div>
                        <div id="live-strategies">
                            <!-- Live strategies will be populated here -->
                        </div>
                    </div>

                    <!-- Order Book -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Active Orders</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="active-orders">
                                <!-- Orders will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Positions -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Open Positions</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Qty</th>
                                    <th>Avg Price</th>
                                    <th>Current</th>
                                    <th>P&L</th>
                                </tr>
                            </thead>
                            <tbody id="open-positions">
                                <!-- Positions will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Real-time Chart -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Real-time Market Data</h3>
                        <div>
                            <select>
                                <option>NIFTY 50</option>
                                <option>BANK NIFTY</option>
                                <option>RELIANCE</option>
                                <option>TCS</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <i class="fas fa-chart-candlestick" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <div>Real-time Candlestick Chart</div>
                    </div>
                </div>
            </div>

            <!-- Portfolio Page -->
            <div id="portfolio" class="page">
                <div class="page-header">
                    <h1 class="page-title">Portfolio Management</h1>
                    <button class="btn btn-primary" onclick="rebalancePortfolio()">
                        <i class="fas fa-balance-scale"></i> Rebalance
                    </button>
                </div>

                <!-- Portfolio Overview -->
                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--primary-color);">₹4,52,850</div>
                        <div class="metric-label">Total Portfolio Value</div>
                        <div class="metric-change positive">+4.2% today</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value positive">+₹18,340</div>
                        <div class="metric-label">Today's P&L</div>
                        <div class="metric-change positive">+4.2%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">₹1,25,000</div>
                        <div class="metric-label">Available Cash</div>
                        <div class="metric-change">27.6% of portfolio</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--warning-color);">65%</div>
                        <div class="metric-label">Risk Utilization</div>
                        <div class="metric-change">Within limits</div>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- Asset Allocation -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Asset Allocation</h3>
                        </div>
                        <div class="chart-container">
                            <i class="fas fa-chart-pie" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <div>Asset Allocation Pie Chart</div>
                        </div>
                    </div>

                    <!-- Risk Metrics -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Risk Metrics</h3>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">1.85</div>
                            <div class="metric-label">Portfolio Beta</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">2.34</div>
                            <div class="metric-label">Sharpe Ratio</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value negative">-8.5%</div>
                            <div class="metric-label">Max Drawdown</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">₹12,450</div>
                            <div class="metric-label">Value at Risk (95%)</div>
                        </div>
                    </div>
                </div>

                <!-- Holdings -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Current Holdings</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Quantity</th>
                                <th>Avg Price</th>
                                <th>Current Price</th>
                                <th>Market Value</th>
                                <th>Day P&L</th>
                                <th>Total P&L</th>
                                <th>Weight</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>RELIANCE</strong></td>
                                <td>50</td>
                                <td>₹2,450</td>
                                <td>₹2,485</td>
                                <td>₹1,24,250</td>
                                <td class="positive">+₹1,750</td>
                                <td class="positive">+₹8,900</td>
                                <td>27.4%</td>
                            </tr>
                            <!-- More holdings... -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Risk Management Page -->
            <div id="risk-management" class="page">
                <div class="page-header">
                    <h1 class="page-title">Risk Management</h1>
                    <button class="btn btn-primary" onclick="updateRiskLimits()">
                        <i class="fas fa-shield-alt"></i> Update Limits
                    </button>
                </div>

                <!-- Risk Overview -->
                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--warning-color);">68%</div>
                        <div class="metric-label">Risk Utilization</div>
                        <div class="metric-change">₹68,000 / ₹100,000</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value negative">-₹12,450</div>
                        <div class="metric-label">Daily VaR (95%)</div>
                        <div class="metric-change">2.75% of portfolio</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value negative">-8.5%</div>
                        <div class="metric-label">Max Drawdown</div>
                        <div class="metric-change">Last 30 days</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">0.85</div>
                        <div class="metric-label">Correlation Risk</div>
                        <div class="metric-change">Portfolio correlation</div>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- Risk Limits -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Risk Limits Configuration</h3>
                        </div>
                        <div class="form-group">
                            <label>Max Portfolio Risk (%)</label>
                            <input type="number" value="5" min="1" max="20">
                        </div>
                        <div class="form-group">
                            <label>Max Single Position Risk (%)</label>
                            <input type="number" value="2" min="0.5" max="10">
                        </div>
                        <div class="form-group">
                            <label>Daily Loss Limit (₹)</label>
                            <input type="number" value="25000">
                        </div>
                        <div class="form-group">
                            <label>Max Drawdown Limit (%)</label>
                            <input type="number" value="15" min="5" max="30">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" checked> Auto-stop on limit breach
                            </label>
                        </div>
                    </div>

                    <!-- Risk Monitoring -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Risk Alerts</h3>
                        </div>
                        <div class="notification warning">
                            <strong>High Correlation Warning</strong><br>
                            Portfolio correlation has increased to 0.85
                        </div>
                        <div class="notification success">
                            <strong>Risk Check Passed</strong><br>
                            All positions within risk limits
                        </div>
                    </div>
                </div>

                <!-- Risk Breakdown -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Risk Breakdown by Strategy</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Strategy</th>
                                <th>Allocated Capital</th>
                                <th>Risk Exposure</th>
                                <th>Daily VaR</th>
                                <th>Max Drawdown</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Momentum Pro</td>
                                <td>₹1,50,000</td>
                                <td>65%</td>
                                <td>-₹4,500</td>
                                <td>-6.8%</td>
                                <td><span class="status running">Active</span></td>
                            </tr>
                            <!-- More strategies... -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Market Data Page -->
            <div id="market-data" class="page">
                <div class="page-header">
                    <h1 class="page-title">Live Market Analysis</h1>
                    <div>
                        <span id="market-status" class="status running pulse">MARKET OPEN</span>
                        <button class="btn btn-primary" onclick="addToWatchlist()">
                            <i class="fas fa-plus"></i> Add Symbol
                        </button>
                    </div>
                </div>

                <!-- Market Overview with Live Updates -->
                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-value positive" id="nifty-price">19,845</div>
                        <div class="metric-label">NIFTY 50</div>
                        <div class="metric-change positive" id="nifty-change">+125 (+0.63%)</div>
                        <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 5px;">
                            Support: 19,750 | Resistance: 19,950
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value negative" id="banknifty-price">45,280</div>
                        <div class="metric-label">BANK NIFTY</div>
                        <div class="metric-change negative" id="banknifty-change">-89 (-0.20%)</div>
                        <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 5px;">
                            Support: 45,000 | Resistance: 45,500
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value positive" id="sensex-price">66,795</div>
                        <div class="metric-label">SENSEX</div>
                        <div class="metric-change positive" id="sensex-change">+234 (+0.35%)</div>
                        <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 5px;">
                            Support: 66,500 | Resistance: 67,200
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--primary-color);" id="vix-value">14.85</div>
                        <div class="metric-label">INDIA VIX</div>
                        <div class="metric-change negative" id="vix-change">-0.45 (-2.94%)</div>
                        <div style="font-size: 0.8rem; color: var(--text-light); margin-top: 5px;">
                            Fear & Greed: Neutral
                        </div>
                    </div>
                </div>

                <!-- Live Technical Analysis -->
                <div class="grid-3">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Live Technical Levels</h3>
                            <select id="technical-symbol" onchange="updateTechnicalLevels()">
                                <option value="NIFTY">NIFTY 50</option>
                                <option value="BANKNIFTY">BANK NIFTY</option>
                                <option value="SENSEX">SENSEX</option>
                            </select>
                        </div>
                        <div id="technical-levels">
                            <div style="margin-bottom: 15px;">
                                <strong>Trend Analysis:</strong>
                                <span class="status running" id="trend-status">BULLISH</span>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Level</th>
                                        <th>Value</th>
                                        <th>Type</th>
                                    </tr>
                                </thead>
                                <tbody id="levels-table">
                                    <tr>
                                        <td>R3</td>
                                        <td>20,150</td>
                                        <td><span style="color: var(--danger-color);">Strong Resistance</span></td>
                                    </tr>
                                    <tr>
                                        <td>R2</td>
                                        <td>19,950</td>
                                        <td><span style="color: var(--warning-color);">Resistance</span></td>
                                    </tr>
                                    <tr>
                                        <td>R1</td>
                                        <td>19,900</td>
                                        <td><span style="color: var(--warning-color);">Minor Resistance</span></td>
                                    </tr>
                                    <tr style="background: rgba(6, 214, 160, 0.1);">
                                        <td><strong>CMP</strong></td>
                                        <td><strong>19,845</strong></td>
                                        <td><strong>Current Price</strong></td>
                                    </tr>
                                    <tr>
                                        <td>S1</td>
                                        <td>19,750</td>
                                        <td><span style="color: var(--success-color);">Minor Support</span></td>
                                    </tr>
                                    <tr>
                                        <td>S2</td>
                                        <td>19,650</td>
                                        <td><span style="color: var(--success-color);">Support</span></td>
                                    </tr>
                                    <tr>
                                        <td>S3</td>
                                        <td>19,500</td>
                                        <td><span style="color: var(--success-color);">Strong Support</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Market Sentiment</h3>
                        </div>
                        <div class="grid-2" style="gap: 15px;">
                            <div class="metric-card">
                                <div class="metric-value positive">72%</div>
                                <div class="metric-label">Bullish Sentiment</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value negative">28%</div>
                                <div class="metric-label">Bearish Sentiment</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <h5>Market Indicators:</h5>
                            <div style="margin: 10px 0;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Advances vs Declines:</span>
                                    <span class="positive">1,456 vs 892</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>New Highs vs Lows:</span>
                                    <span class="positive">234 vs 45</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>FII Activity:</span>
                                    <span class="positive">+₹1,250 Cr</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>DII Activity:</span>
                                    <span class="negative">-₹890 Cr</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Sector Performance</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Sector</th>
                                    <th>Change %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Banking</td>
                                    <td class="positive">+1.24%</td>
                                </tr>
                                <tr>
                                    <td>IT</td>
                                    <td class="positive">+0.89%</td>
                                </tr>
                                <tr>
                                    <td>Pharma</td>
                                    <td class="negative">-0.45%</td>
                                </tr>
                                <tr>
                                    <td>Auto</td>
                                    <td class="positive">+0.67%</td>
                                </tr>
                                <tr>
                                    <td>Metal</td>
                                    <td class="negative">-1.23%</td>
                                </tr>
                                <tr>
                                    <td>Energy</td>
                                    <td class="positive">+0.34%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Advanced Market Analysis -->
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Intraday Chart Analysis</h3>
                            <div class="tabs" style="width: auto; margin: 0;">
                                <button class="tab-btn active" onclick="updateMarketChart('1m')">1M</button>
                                <button class="tab-btn" onclick="updateMarketChart('5m')">5M</button>
                                <button class="tab-btn" onclick="updateMarketChart('15m')">15M</button>
                                <button class="tab-btn" onclick="updateMarketChart('1h')">1H</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <i class="fas fa-chart-candlestick" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <div>Live Candlestick Chart with Technical Overlays</div>
                            <div style="margin-top: 10px; font-size: 0.9rem; color: var(--text-light);">
                                EMA(20): 19,823 | RSI: 68.5 | MACD: Bullish
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Options Flow Analysis</h3>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Call:Put Ratio:</span>
                                <strong>1.24</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Max Pain:</span>
                                <strong>19,800</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>PCR:</span>
                                <strong>0.81</strong>
                            </div>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Strike</th>
                                    <th>Call OI</th>
                                    <th>Put OI</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>19700</td>
                                    <td>45,250</td>
                                    <td>89,450</td>
                                    <td><span class="status running">Support</span></td>
                                </tr>
                                <tr>
                                    <td>19800</td>
                                    <td>67,890</td>
                                    <td>156,780</td>
                                    <td><span class="status running">Strong Support</span></td>
                                </tr>
                                <tr style="background: rgba(6, 214, 160, 0.1);">
                                    <td><strong>19850</strong></td>
                                    <td><strong>89,340</strong></td>
                                    <td><strong>78,920</strong></td>
                                    <td><strong>ATM</strong></td>
                                </tr>
                                <tr>
                                    <td>19900</td>
                                    <td>123,450</td>
                                    <td>45,670</td>
                                    <td><span class="status stopped">Resistance</span></td>
                                </tr>
                                <tr>
                                    <td>20000</td>
                                    <td>234,560</td>
                                    <td>23,890</td>
                                    <td><span class="status stopped">Strong Resistance</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Enhanced Watchlist -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Smart Watchlist</h3>
                        <div>
                            <input type="text" id="add-symbol-input" placeholder="Add symbol (e.g., RELIANCE)" style="padding: 8px; border: 1px solid var(--border-color); border-radius: 5px; margin-right: 10px;">
                            <button class="btn btn-sm btn-primary" onclick="addSymbolToWatchlist()">Add</button>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>LTP</th>
                                <th>Change</th>
                                <th>Volume</th>
                                <th>RSI</th>
                                <th>Support</th>
                                <th>Resistance</th>
                                <th>Signal</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="enhanced-watchlist-table">
                            <!-- Enhanced watchlist items will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Paper Trading Page -->
            <div id="paper-trading" class="page">
                <div class="page-header">
                    <h1 class="page-title">Paper Trading Environment</h1>
                    <div>
                        <span class="status running">📊 SIMULATION MODE</span>
                        <button class="btn btn-primary" onclick="resetPaperAccount()">
                            <i class="fas fa-refresh"></i> Reset Account
                        </button>
                    </div>
                </div>

                <!-- Paper Trading Stats -->
                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--primary-color);" id="paper-portfolio-value">₹10,45,680</div>
                        <div class="metric-label">Virtual Portfolio Value</div>
                        <div class="metric-change positive" id="paper-portfolio-change">+₹45,680 (+4.57%)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="paper-trades-count">156</div>
                        <div class="metric-label">Total Paper Trades</div>
                        <div class="metric-change">89 Wins | 67 Loss</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value positive" id="paper-win-rate">57.1%</div>
                        <div class="metric-label">Win Rate</div>
                        <div class="metric-change positive">+2.3% this week</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--accent-color);" id="paper-available-cash">₹2,54,320</div>
                        <div class="metric-label">Available Cash</div>
                        <div class="metric-change">25.4% of portfolio</div>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- Paper Trading Controls -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Quick Paper Trade</h3>
                        </div>
                        <div class="form-group">
                            <label>Symbol</label>
                            <input type="text" id="paper-symbol" placeholder="e.g., RELIANCE" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px;">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Quantity</label>
                                <input type="number" id="paper-quantity" value="1" min="1" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px;">
                            </div>
                            <div class="form-group">
                                <label>Order Type</label>
                                <select id="paper-order-type" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px;">
                                    <option value="market">Market</option>
                                    <option value="limit">Limit</option>
                                    <option value="sl">Stop Loss</option>
                                    <option value="sl-m">Stop Loss Market</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group" id="paper-price-group" style="display: none;">
                            <label>Price</label>
                            <input type="number" id="paper-price" step="0.01" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px;">
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-success" onclick="placePaperTrade('BUY')" style="flex: 1;">
                                <i class="fas fa-arrow-up"></i> Buy
                            </button>
                            <button class="btn btn-danger" onclick="placePaperTrade('SELL')" style="flex: 1;">
                                <i class="fas fa-arrow-down"></i> Sell
                            </button>
                        </div>
                    </div>

                    <!-- Paper Portfolio Holdings -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Paper Portfolio Holdings</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Qty</th>
                                    <th>Avg Price</th>
                                    <th>LTP</th>
                                    <th>P&L</th>
                                </tr>
                            </thead>
                            <tbody id="paper-holdings-table">
                                <tr>
                                    <td><strong>RELIANCE</strong></td>
                                    <td>50</td>
                                    <td>₹2,450</td>
                                    <td>₹2,485</td>
                                    <td class="positive">+₹1,750</td>
                                </tr>
                                <tr>
                                    <td><strong>TCS</strong></td>
                                    <td>25</td>
                                    <td>₹3,680</td>
                                    <td>₹3,695</td>
                                    <td class="positive">+₹375</td>
                                </tr>
                                <tr>
                                    <td><strong>INFY</strong></td>
                                    <td>40</td>
                                    <td>₹1,420</td>
                                    <td>₹1,435</td>
                                    <td class="positive">+₹600</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Paper Trading Performance -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Paper Trading Performance</h3>
                        <div class="tabs" style="width: auto; margin: 0;">
                            <button class="tab-btn active" onclick="updatePaperChart('1D')">1D</button>
                            <button class="tab-btn" onclick="updatePaperChart('1W')">1W</button>
                            <button class="tab-btn" onclick="updatePaperChart('1M')">1M</button>
                            <button class="tab-btn" onclick="updatePaperChart('3M')">3M</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 15px; color: var(--accent-color);"></i>
                        <div>Paper Trading Equity Curve</div>
                        <div style="margin-top: 10px; color: var(--text-light);">
                            Track your virtual trading performance over time
                        </div>
                    </div>
                </div>
            </div>

            <!-- Options Trading Page -->
            <div id="options-trading" class="page">
                <div class="page-header">
                    <h1 class="page-title">Options Trading Platform</h1>
                    <div>
                        <span id="options-expiry-timer" class="status running">Weekly Expiry: 2d 14h 32m</span>
                        <button class="btn btn-primary" onclick="showOptionStrategy()">
                            <i class="fas fa-chess"></i> Strategy Builder
                        </button>
                    </div>
                </div>

                <!-- Options Market Overview -->
                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-value">1.24</div>
                        <div class="metric-label">Call:Put Ratio</div>
                        <div class="metric-change positive">Bullish Sentiment</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">19,800</div>
                        <div class="metric-label">Max Pain</div>
                        <div class="metric-change">50 points below CMP</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value negative">0.81</div>
                        <div class="metric-label">PCR (OI)</div>
                        <div class="metric-change">Slightly Bearish</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--warning-color);">14.85</div>
                        <div class="metric-label">Implied Volatility</div>
                        <div class="metric-change negative">-2.3% today</div>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" onclick="showOptionsTab('chain')">Options Chain</button>
                    <button class="tab-btn" onclick="showOptionsTab('strategies')">Strategies</button>
                    <button class="tab-btn" onclick="showOptionsTab('greeks')">Greeks Analysis</button>
                    <button class="tab-btn" onclick="showOptionsTab('scanner')">Options Scanner</button>
                </div>

                <!-- Options Chain -->
                <div id="options-chain" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">NIFTY Options Chain</h3>
                            <div>
                                <select id="options-expiry" onchange="updateOptionsChain()">
                                    <option value="weekly">28-DEC-2024 (Weekly)</option>
                                    <option value="monthly">26-JAN-2025 (Monthly)</option>
                                    <option value="quarterly">27-MAR-2025 (Quarterly)</option>
                                </select>
                            </div>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th colspan="6" style="text-align: center; background: rgba(16, 185, 129, 0.1); color: var(--success-color);">CALL OPTIONS</th>
                                        <th style="background: var(--light-bg); font-weight: bold;">STRIKE</th>
                                        <th colspan="6" style="text-align: center; background: rgba(239, 68, 68, 0.1); color: var(--danger-color);">PUT OPTIONS</th>
                                    </tr>
                                    <tr>
                                        <th>OI</th>
                                        <th>Chng OI</th>
                                        <th>Volume</th>
                                        <th>IV</th>
                                        <th>LTP</th>
                                        <th>Chng</th>
                                        <th style="background: var(--light-bg); font-weight: bold;">PRICE</th>
                                        <th>Chng</th>
                                        <th>LTP</th>
                                        <th>IV</th>
                                        <th>Volume</th>
                                        <th>Chng OI</th>
                                        <th>OI</th>
                                    </tr>
                                </thead>
                                <tbody id="options-chain-table">
                                    <!-- Options chain data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Options Strategies -->
                <div id="options-strategies" class="tab-content">
                    <div class="grid-3">
                        <div class="card">
                            <h4><i class="fas fa-chart-line"></i> Bull Call Spread</h4>
                            <p>Moderately bullish strategy with limited risk and reward</p>
                            <div style="margin: 15px 0;">
                                <div>Max Profit: ₹2,500</div>
                                <div>Max Loss: ₹1,500</div>
                                <div>Breakeven: 19,915</div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="createStrategy('bull-call-spread')">Create Strategy</button>
                        </div>
                        
                        <div class="card">
                            <h4><i class="fas fa-shield-alt"></i> Iron Condor</h4>
                            <p>Market neutral strategy for range-bound markets</p>
                            <div style="margin: 15px 0;">
                                <div>Max Profit: ₹3,200</div>
                                <div>Max Loss: ₹1,800</div>
                                <div>Range: 19,750 - 19,950</div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="createStrategy('iron-condor')">Create Strategy</button>
                        </div>
                        
                        <div class="card">
                            <h4><i class="fas fa-chart-area"></i> Long Straddle</h4>
                            <p>High volatility strategy for big moves in either direction</p>
                            <div style="margin: 15px 0;">
                                <div>Max Profit: Unlimited</div>
                                <div>Max Loss: ₹4,500</div>
                                <div>Breakevens: 19,650 & 20,050</div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="createStrategy('long-straddle')">Create Strategy</button>
                        </div>
                    </div>

                    <!-- Active Options Positions -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Active Options Positions</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Strategy</th>
                                    <th>Strikes</th>
                                    <th>Type</th>
                                    <th>Qty</th>
                                    <th>Premium</th>
                                    <th>Current Value</th>
                                    <th>P&L</th>
                                    <th>Greeks</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Bull Call Spread</td>
                                    <td>19800/19900</td>
                                    <td>CE/CE</td>
                                    <td>50/50</td>
                                    <td>₹1,750</td>
                                    <td>₹2,100</td>
                                    <td class="positive">+₹350</td>
                                    <td>Δ: 0.35, Θ: -12</td>
                                    <td>
                                        <button class="btn btn-sm btn-danger">Close</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Greeks Analysis -->
                <div id="options-greeks" class="tab-content">
                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Portfolio Greeks</h3>
                            </div>
                            <div class="grid-2">
                                <div class="metric-card">
                                    <div class="metric-value">245.8</div>
                                    <div class="metric-label">Portfolio Delta</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value negative">-156.2</div>
                                    <div class="metric-label">Portfolio Theta</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">89.4</div>
                                    <div class="metric-label">Portfolio Gamma</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">1,234</div>
                                    <div class="metric-label">Portfolio Vega</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Risk Analysis</h3>
                            </div>
                            <div class="chart-container" style="height: 200px;">
                                <i class="fas fa-chart-line" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                <div>P&L Chart by Underlying Price</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Options Scanner -->
                <div id="options-scanner" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Options Opportunity Scanner</h3>
                            <div>
                                <select id="scanner-filter" onchange="updateOptionsScanner()">
                                    <option value="high-iv">High IV Options</option>
                                    <option value="volume-surge">Volume Surge</option>
                                    <option value="oi-buildup">OI Buildup</option>
                                    <option value="arbitrage">Arbitrage Opportunities</option>
                                </select>
                            </div>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Strike</th>
                                    <th>Type</th>
                                    <th>LTP</th>
                                    <th>IV</th>
                                    <th>Volume</th>
                                    <th>OI Change</th>
                                    <th>Signal</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="options-scanner-table">
                                <tr>
                                    <td>NIFTY</td>
                                    <td>19850</td>
                                    <td>CE</td>
                                    <td>45.5</td>
                                    <td>18.5%</td>
                                    <td>156,890</td>
                                    <td class="positive">+45,670</td>
                                    <td><span class="status running">BUY</span></td>
                                    <td><button class="btn btn-sm btn-primary">Trade</button></td>
                                </tr>
                                <tr>
                                    <td>BANKNIFTY</td>
                                    <td>45000</td>
                                    <td>PE</td>
                                    <td>89.75</td>
                                    <td>22.3%</td>
                                    <td>234,560</td>
                                    <td class="positive">+67,890</td>
                                    <td><span class="status running">BUY</span></td>
                                    <td><button class="btn btn-sm btn-primary">Trade</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Trade Reports Page -->
            <div id="trade-reports" class="page">
                <div class="page-header">
                    <h1 class="page-title">Comprehensive Trade Reports</h1>
                    <div>
                        <button class="btn btn-secondary" onclick="exportTradeReport()">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                        <button class="btn btn-primary" onclick="generateTaxReport()">
                            <i class="fas fa-file-invoice-dollar"></i> Tax Report
                        </button>
                    </div>
                </div>

                <!-- Trade Summary -->
                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-value positive" id="total-trades-pnl">+₹1,24,580</div>
                        <div class="metric-label">Total P&L (All Time)</div>
                        <div class="metric-change positive">+18.7% return</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="total-trades-count">1,456</div>
                        <div class="metric-label">Total Trades</div>
                        <div class="metric-change">892 wins | 564 loss</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value positive" id="overall-win-rate">61.3%</div>
                        <div class="metric-label">Overall Win Rate</div>
                        <div class="metric-change positive">Above average</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value positive" id="avg-profit">₹2,145</div>
                        <div class="metric-label">Avg Profit/Trade</div>
                        <div class="metric-change">Risk:Reward 1:2.1</div>
                    </div>
                </div>

                <!-- Trade Filters -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Trade Filters & Analysis</h3>
                    </div>
                    <div class="grid-4">
                        <div class="form-group">
                            <label>Date Range</label>
                            <select id="trade-date-filter" onchange="filterTrades()">
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="quarter">This Quarter</option>
                                <option value="year">This Year</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Asset Type</label>
                            <select id="trade-type-filter" onchange="filterTrades()">
                                <option value="all">All Types</option>
                                <option value="equity">Equity</option>
                                <option value="options">Options</option>
                                <option value="futures">Futures</option>
                                <option value="currency">Currency</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Strategy</label>
                            <select id="trade-strategy-filter" onchange="filterTrades()">
                                <option value="all">All Strategies</option>
                                <option value="momentum">Momentum</option>
                                <option value="mean-reversion">Mean Reversion</option>
                                <option value="arbitrage">Arbitrage</option>
                                <option value="manual">Manual</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Symbol</label>
                            <input type="text" id="trade-symbol-filter" placeholder="e.g., RELIANCE" onchange="filterTrades()">
                        </div>
                    </div>
                </div>

                <!-- Detailed Trade Log -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Detailed Trade Log</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Trade ID</th>
                                    <th>Date</th>
                                    <th>Symbol</th>
                                    <th>Type</th>
                                    <th>Side</th>
                                    <th>Quantity</th>
                                    <th>Entry Time</th>
                                    <th>Entry Price</th>
                                    <th>Exit Time</th>
                                    <th>Exit Price</th>
                                    <th>P&L</th>
                                    <th>P&L %</th>
                                    <th>Strategy</th>
                                    <th>Commission</th>
                                    <th>Net P&L</th>
                                </tr>
                            </thead>
                            <tbody id="detailed-trade-log">
                                <tr>
                                    <td>TXN001456</td>
                                    <td>28-Dec-2024</td>
                                    <td><strong>RELIANCE</strong></td>
                                    <td>Equity</td>
                                    <td><span class="status running">BUY</span></td>
                                    <td>50</td>
                                    <td>09:32:15</td>
                                    <td>₹2,450.00</td>
                                    <td>14:56:23</td>
                                    <td>₹2,485.50</td>
                                    <td class="positive">+₹1,775</td>
                                    <td class="positive">+1.45%</td>
                                    <td>Momentum Pro</td>
                                    <td>₹40</td>
                                    <td class="positive">+₹1,735</td>
                                </tr>
                                <tr>
                                    <td>TXN001455</td>
                                    <td>28-Dec-2024</td>
                                    <td><strong>TCS</strong></td>
                                    <td>Equity</td>
                                    <td><span class="status stopped">SELL</span></td>
                                    <td>25</td>
                                    <td>10:15:42</td>
                                    <td>₹3,695.75</td>
                                    <td>15:23:18</td>
                                    <td>₹3,680.25</td>
                                    <td class="negative">-₹387.50</td>
                                    <td class="negative">-0.42%</td>
                                    <td>Mean Reversion</td>
                                    <td>₹40</td>
                                    <td class="negative">-₹427.50</td>
                                </tr>
                                <tr>
                                    <td>TXN001454</td>
                                    <td>27-Dec-2024</td>
                                    <td><strong>NIFTY 19850 CE</strong></td>
                                    <td>Options</td>
                                    <td><span class="status running">BUY</span></td>
                                    <td>100</td>
                                    <td>11:45:30</td>
                                    <td>₹45.50</td>
                                    <td>13:20:45</td>
                                    <td>₹67.25</td>
                                    <td class="positive">+₹2,175</td>
                                    <td class="positive">+47.8%</td>
                                    <td>Options Scalping</td>
                                    <td>₹80</td>
                                    <td class="positive">+₹2,095</td>
                                </tr>
                                <tr>
                                    <td>TXN001453</td>
                                    <td>27-Dec-2024</td>
                                    <td><strong>BANKNIFTY</strong></td>
                                    <td>Futures</td>
                                    <td><span class="status running">BUY</span></td>
                                    <td>1</td>
                                    <td>14:20:10</td>
                                    <td>₹45,180.50</td>
                                    <td>15:45:33</td>
                                    <td>₹45,285.75</td>
                                    <td class="positive">+₹525</td>
                                    <td class="positive">+0.23%</td>
                                    <td>Arbitrage</td>
                                    <td>₹60</td>
                                    <td class="positive">+₹465</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Trade Analytics -->
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Performance by Strategy</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Strategy</th>
                                    <th>Trades</th>
                                    <th>Win Rate</th>
                                    <th>Avg P&L</th>
                                    <th>Total P&L</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Momentum Pro</td>
                                    <td>456</td>
                                    <td class="positive">67.3%</td>
                                    <td class="positive">₹1,890</td>
                                    <td class="positive">₹86,184</td>
                                </tr>
                                <tr>
                                    <td>Mean Reversion</td>
                                    <td>289</td>
                                    <td class="positive">58.1%</td>
                                    <td class="positive">₹945</td>
                                    <td class="positive">₹27,311</td>
                                </tr>
                                <tr>
                                    <td>Options Scalping</td>
                                    <td>234</td>
                                    <td class="positive">71.8%</td>
                                    <td class="positive">₹2,456</td>
                                    <td class="positive">₹57,510</td>
                                </tr>
                                <tr>
                                    <td>Arbitrage</td>
                                    <td>145</td>
                                    <td class="positive">89.7%</td>
                                    <td class="positive">₹678</td>
                                    <td class="positive">₹9,831</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Monthly P&L Analysis</h3>
                        </div>
                        <div class="chart-container">
                            <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <div>Monthly P&L Performance Chart</div>
                        </div>
                    </div>
                </div>

                <!-- Tax Optimization -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tax Optimization Analysis</h3>
                    </div>
                    <div class="grid-3">
                        <div class="metric-card">
                            <div class="metric-value positive">₹89,650</div>
                            <div class="metric-label">Short Term Gains</div>
                            <div class="metric-change">Tax: ₹13,448 (15%)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value positive">₹34,930</div>
                            <div class="metric-label">Long Term Gains</div>
                            <div class="metric-change">Tax: ₹3,493 (10%)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value negative">₹12,450</div>
                            <div class="metric-label">Losses for Set-off</div>
                            <div class="metric-change">Available for adjustment</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Broker Integration Page -->
            <div id="broker-integration" class="page">
                <div class="page-header">
                    <h1 class="page-title">Broker API Integration</h1>
                    <button class="btn btn-primary" onclick="addNewBroker()">
                        <i class="fas fa-plus"></i> Add Broker
                    </button>
                </div>

                <!-- Broker Status Overview -->
                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--success-color);">2</div>
                        <div class="metric-label">Connected Brokers</div>
                        <div class="metric-change">Active & Synced</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--primary-color);">₹7,45,680</div>
                        <div class="metric-label">Total Balance</div>
                        <div class="metric-change">Across all brokers</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" style="color: var(--accent-color);">45ms</div>
                        <div class="metric-label">Avg API Latency</div>
                        <div class="metric-change">Excellent performance</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value positive">99.8%</div>
                        <div class="metric-label">Uptime</div>
                        <div class="metric-change">Last 30 days</div>
                    </div>
                </div>

                <!-- Zerodha Integration -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-plug"></i> Zerodha Kite Integration</h3>
                        <div>
                            <span class="status running" id="zerodha-status">CONNECTED</span>
                        </div>
                    </div>
                    <div class="grid-2">
                        <div>
                            <h5>API Configuration</h5>
                            <div class="form-group">
                                <label>API Key</label>
                                <input type="text" id="zerodha-api-key" placeholder="Enter your Zerodha API Key" value="kite_api_key_****">
                            </div>
                            <div class="form-group">
                                <label>API Secret</label>
                                <input type="password" id="zerodha-api-secret" placeholder="Enter your Zerodha API Secret" value="*****************">
                            </div>
                            <div class="form-group">
                                <label>Request Token</label>
                                <input type="text" id="zerodha-request-token" placeholder="Request token from login">
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="zerodha-auto-login" checked> 
                                    Auto-login on startup
                                </label>
                            </div>
                            <button class="btn btn-primary" onclick="connectZerodha()">
                                <i class="fas fa-link"></i> Connect/Reconnect
                            </button>
                            <button class="btn btn-secondary" onclick="testZerodhaConnection()">
                                <i class="fas fa-check"></i> Test Connection
                            </button>
                        </div>
                        <div>
                            <h5>Account Information</h5>
                            <div style="background: var(--light-bg); padding: 20px; border-radius: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Client ID:</span>
                                    <strong id="zerodha-client-id">AB1234</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Available Balance:</span>
                                    <strong id="zerodha-balance" class="positive">₹3,45,680</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Utilized Margin:</span>
                                    <strong id="zerodha-margin">₹1,23,450</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Open Positions:</span>
                                    <strong id="zerodha-positions">8</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span>Last Sync:</span>
                                    <strong id="zerodha-last-sync">2 mins ago</strong>
                                </div>
                            </div>
                            <button class="btn btn-success" onclick="syncZerodhaData()" style="width: 100%; margin-top: 15px;">
                                <i class="fas fa-sync"></i> Sync Portfolio Data
                            </button>
                        </div>
                    </div>
                </div>

                <!-- API Endpoints Configuration -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">API Endpoints & Settings</h3>
                    </div>
                    <div class="tabs">
                        <button class="tab-btn active" onclick="showBrokerTab('endpoints')">Endpoints</button>
                        <button class="tab-btn" onclick="showBrokerTab('permissions')">Permissions</button>
                        <button class="tab-btn" onclick="showBrokerTab('limits')">Rate Limits</button>
                        <button class="tab-btn" onclick="showBrokerTab('logs')">API Logs</button>
                    </div>

                    <!-- Endpoints Tab -->
                    <div id="broker-endpoints" class="tab-content active">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Endpoint</th>
                                    <th>Method</th>
                                    <th>Purpose</th>
                                    <th>Status</th>
                                    <th>Last Called</th>
                                    <th>Response Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>/orders</td>
                                    <td>GET</td>
                                    <td>Fetch orders</td>
                                    <td><span class="status running">Active</span></td>
                                    <td>2 mins ago</td>
                                    <td>45ms</td>
                                </tr>
                                <tr>
                                    <td>/positions</td>
                                    <td>GET</td>
                                    <td>Fetch positions</td>
                                    <td><span class="status running">Active</span></td>
                                    <td>1 min ago</td>
                                    <td>38ms</td>
                                </tr>
                                <tr>
                                    <td>/orders</td>
                                    <td>POST</td>
                                    <td>Place order</td>
                                    <td><span class="status running">Active</span></td>
                                    <td>5 mins ago</td>
                                    <td>67ms</td>
                                </tr>
                                <tr>
                                    <td>/orders/{order_id}</td>
                                    <td>PUT</td>
                                    <td>Modify order</td>
                                    <td><span class="status running">Active</span></td>
                                    <td>10 mins ago</td>
                                    <td>52ms</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Permissions Tab -->
                    <div id="broker-permissions" class="tab-content">
                        <div class="grid-2">
                            <div>
                                <h5>Trading Permissions</h5>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Equity Trading
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Options Trading
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Futures Trading
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox"> Currency Trading
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox"> Commodity Trading
                                    </label>
                                </div>
                            </div>
                            <div>
                                <h5>Data Permissions</h5>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Live Market Data
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Historical Data
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Portfolio Data
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" checked> Order Book Access
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rate Limits Tab -->
                    <div id="broker-limits" class="tab-content">
                        <div class="grid-3">
                            <div class="metric-card">
                                <div class="metric-value">156</div>
                                <div class="metric-label">API Calls/Minute</div>
                                <div class="metric-change">Limit: 300/min</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">2,340</div>
                                <div class="metric-label">Daily API Calls</div>
                                <div class="metric-change">Limit: 100,000/day</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value">45</div>
                                <div class="metric-label">Orders/Hour</div>
                                <div class="metric-change">Limit: 1,000/hour</div>
                            </div>
                        </div>
                    </div>

                    <!-- API Logs Tab -->
                    <div id="broker-logs" class="tab-content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Endpoint</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Response Time</th>
                                    <th>Message</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>14:32:15</td>
                                    <td>/orders</td>
                                    <td>POST</td>
                                    <td><span class="status running">200</span></td>
                                    <td>67ms</td>
                                    <td>Order placed successfully</td>
                                </tr>
                                <tr>
                                    <td>14:31:45</td>
                                    <td>/positions</td>
                                    <td>GET</td>
                                    <td><span class="status running">200</span></td>
                                    <td>38ms</td>
                                    <td>Positions fetched</td>
                                </tr>
                                <tr>
                                    <td>14:31:20</td>
                                    <td>/orders</td>
                                    <td>GET</td>
                                    <td><span class="status running">200</span></td>
                                    <td>45ms</td>
                                    <td>Orders list retrieved</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Portfolio Sync Status -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Portfolio Synchronization</h3>
                        <button class="btn btn-primary" onclick="forcePortfolioSync()">
                            <i class="fas fa-sync"></i> Force Sync
                        </button>
                    </div>
                    <div class="grid-2">
                        <div>
                            <h5>Sync Status</h5>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Data Type</th>
                                        <th>Last Sync</th>
                                        <th>Status</th>
                                        <th>Records</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Holdings</td>
                                        <td>2 mins ago</td>
                                        <td><span class="status running">Synced</span></td>
                                        <td>23</td>
                                    </tr>
                                    <tr>
                                        <td>Orders</td>
                                        <td>1 min ago</td>
                                        <td><span class="status running">Synced</span></td>
                                        <td>156</td>
                                    </tr>
                                    <tr>
                                        <td>Positions</td>
                                        <td>30 sec ago</td>
                                        <td><span class="status running">Synced</span></td>
                                        <td>8</td>
                                    </tr>
                                    <tr>
                                        <td>Funds</td>
                                        <td>1 min ago</td>
                                        <td><span class="status running">Synced</span></td>
                                        <td>1</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <h5>Auto-Sync Settings</h5>
                            <div class="form-group">
                                <label>Portfolio Sync Interval</label>
                                <select>
                                    <option>Real-time</option>
                                    <option selected>Every 30 seconds</option>
                                    <option>Every minute</option>
                                    <option>Every 5 minutes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Sync on trade execution
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Sync on order modification
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox"> Sync during market hours only
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Research Page -->
            <div id="research" class="page">
                <div class="page-header">
                    <h1 class="page-title">Research Laboratory</h1>
                    <button class="btn btn-primary" onclick="createNotebook()">
                        <i class="fas fa-plus"></i> New Notebook
                    </button>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" onclick="showResearchTab('notebooks')">Research Notebooks</button>
                    <button class="tab-btn" onclick="showResearchTab('data-analysis')">Data Analysis</button>
                    <button class="tab-btn" onclick="showResearchTab('ml-models')">ML Models</button>
                </div>

                <!-- Research Notebooks -->
                <div id="notebooks" class="tab-content active">
                    <div class="grid-3">
                        <div class="card">
                            <h4>Market Regime Analysis</h4>
                            <p>Analyzing different market regimes using HMM models</p>
                            <div style="margin: 15px 0;">
                                <span class="status running">Running</span>
                                <span style="margin-left: 10px; color: var(--text-light);">Last run: 2 hours ago</span>
                            </div>
                            <button class="btn btn-primary btn-sm">Open Notebook</button>
                        </div>
                        
                        <div class="card">
                            <h4>Factor Analysis</h4>
                            <p>Multi-factor model for stock returns prediction</p>
                            <div style="margin: 15px 0;">
                                <span class="status stopped">Stopped</span>
                                <span style="margin-left: 10px; color: var(--text-light);">Last run: 1 day ago</span>
                            </div>
                            <button class="btn btn-primary btn-sm">Open Notebook</button>
                        </div>
                        
                        <div class="card">
                            <h4>Sentiment Analysis</h4>
                            <p>News sentiment impact on stock prices</p>
                            <div style="margin: 15px 0;">
                                <span class="status running">Running</span>
                                <span style="margin-left: 10px; color: var(--text-light);">Last run: 30 min ago</span>
                            </div>
                            <button class="btn btn-primary btn-sm">Open Notebook</button>
                        </div>
                    </div>
                </div>

                <!-- Data Analysis -->
                <div id="data-analysis" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Data Analysis Tools</h3>
                        </div>
                        <div class="grid-2">
                            <div>
                                <h5>Correlation Analysis</h5>
                                <div class="chart-container" style="height: 250px;">
                                    <i class="fas fa-project-diagram" style="font-size: 2rem;"></i>
                                    <div>Correlation Heatmap</div>
                                </div>
                            </div>
                            <div>
                                <h5>Returns Distribution</h5>
                                <div class="chart-container" style="height: 250px;">
                                    <i class="fas fa-chart-bar" style="font-size: 2rem;"></i>
                                    <div>Returns Histogram</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ML Models -->
                <div id="ml-models" class="tab-content">
                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Active Models</h3>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Model</th>
                                        <th>Type</th>
                                        <th>Accuracy</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>LSTM Price Predictor</td>
                                        <td>Deep Learning</td>
                                        <td>87.3%</td>
                                        <td><span class="status running">Training</span></td>
                                    </tr>
                                    <tr>
                                        <td>Random Forest Classifier</td>
                                        <td>Ensemble</td>
                                        <td>79.1%</td>
                                        <td><span class="status running">Deployed</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Model Performance</h3>
                            </div>
                            <div class="chart-container">
                                <i class="fas fa-brain" style="font-size: 3rem; margin-bottom: 15px;"></i>
                                <div>Model Performance Metrics</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Optimization Page -->
            <div id="optimization" class="page">
                <div class="page-header">
                    <h1 class="page-title">Strategy Optimization</h1>
                    <button class="btn btn-primary" onclick="startOptimization()">
                        <i class="fas fa-cogs"></i> Start Optimization
                    </button>
                </div>

                <div class="grid-2">
                    <!-- Optimization Configuration -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Optimization Settings</h3>
                        </div>
                        <div class="form-group">
                            <label>Strategy to Optimize</label>
                            <select>
                                <option>Momentum Strategy v2.1</option>
                                <option>Mean Reversion Pro</option>
                                <option>Arbitrage Master</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Optimization Method</label>
                            <select>
                                <option>Genetic Algorithm</option>
                                <option>Particle Swarm</option>
                                <option>Grid Search</option>
                                <option>Bayesian Optimization</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Objective Function</label>
                            <select>
                                <option>Maximize Sharpe Ratio</option>
                                <option>Maximize Total Return</option>
                                <option>Minimize Drawdown</option>
                                <option>Maximize Profit Factor</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Walk-Forward Analysis</label>
                            <input type="checkbox" checked> Enable walk-forward
                        </div>
                    </div>

                    <!-- Optimization Results -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Optimization Progress</h3>
                        </div>
                        <div style="text-align: center; margin: 50px 0;">
                            <i class="fas fa-cogs fa-spin" style="font-size: 3rem; color: var(--primary-color);"></i>
                            <div style="margin-top: 15px;">Optimization in progress...</div>
                            <div style="margin-top: 10px; color: var(--text-light);">Generation 24/100</div>
                        </div>
                    </div>
                </div>

                <!-- Parameter Space -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Parameter Optimization Space</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Current Value</th>
                                <th>Min</th>
                                <th>Max</th>
                                <th>Step</th>
                                <th>Optimize</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>SMA Fast Period</td>
                                <td>10</td>
                                <td>5</td>
                                <td>20</td>
                                <td>1</td>
                                <td><input type="checkbox" checked></td>
                            </tr>
                            <tr>
                                <td>SMA Slow Period</td>
                                <td>30</td>
                                <td>20</td>
                                <td>50</td>
                                <td>5</td>
                                <td><input type="checkbox" checked></td>
                            </tr>
                            <tr>
                                <td>RSI Period</td>
                                <td>14</td>
                                <td>10</td>
                                <td>25</td>
                                <td>1</td>
                                <td><input type="checkbox"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Alerts Page -->
            <div id="alerts" class="page">
                <div class="page-header">
                    <h1 class="page-title">Alerts & Signals</h1>
                    <button class="btn btn-primary" onclick="createAlert()">
                        <i class="fas fa-plus"></i> Create Alert
                    </button>
                </div>

                <div class="grid-2">
                    <!-- Active Alerts -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Active Alerts</h3>
                        </div>
                        <div class="notification success">
                            <strong>Price Alert Triggered</strong><br>
                            RELIANCE crossed ₹2,500 - Target reached
                        </div>
                        <div class="notification warning">
                            <strong>Risk Alert</strong><br>
                            Portfolio risk exposure above 70%
                        </div>
                        <div class="notification error">
                            <strong>Strategy Alert</strong><br>
                            Momentum strategy stopped due to consecutive losses
                        </div>
                    </div>

                    <!-- Signal Generator -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Signal Generator</h3>
                        </div>
                        <div class="form-group">
                            <label>Signal Type</label>
                            <select>
                                <option>Price Alert</option>
                                <option>Technical Indicator</option>
                                <option>Volume Alert</option>
                                <option>News Sentiment</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Symbol</label>
                            <input type="text" placeholder="e.g., RELIANCE">
                        </div>
                        <div class="form-group">
                            <label>Condition</label>
                            <select>
                                <option>Price Above</option>
                                <option>Price Below</option>
                                <option>RSI Overbought</option>
                                <option>RSI Oversold</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Threshold</label>
                            <input type="number" placeholder="2500">
                        </div>
                    </div>
                </div>

                <!-- Recent Signals -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Signals</h3>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Symbol</th>
                                <th>Signal</th>
                                <th>Type</th>
                                <th>Confidence</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>14:32:15</td>
                                <td>TCS</td>
                                <td>Buy Signal</td>
                                <td>Technical</td>
                                <td>89%</td>
                                <td><button class="btn btn-sm btn-primary">Execute</button></td>
                            </tr>
                            <!-- More signals... -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <div class="page-header">
                    <h1 class="page-title">Advanced Analytics</h1>
                    <button class="btn btn-primary" onclick="generateReport()">
                        <i class="fas fa-file-export"></i> Generate Report
                    </button>
                </div>

                <!-- Performance Analytics -->
                <div class="grid-4">
                    <div class="metric-card">
                        <div class="metric-value">2.34</div>
                        <div class="metric-label">Sharpe Ratio</div>
                        <div class="metric-change positive">Excellent</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">1.85</div>
                        <div class="metric-label">Sortino Ratio</div>
                        <div class="metric-change positive">Very Good</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">0.45</div>
                        <div class="metric-label">Information Ratio</div>
                        <div class="metric-change">vs Benchmark</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">12.5</div>
                        <div class="metric-label">Calmar Ratio</div>
                        <div class="metric-change positive">Strong</div>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- Performance Attribution -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Performance Attribution</h3>
                        </div>
                        <div class="chart-container">
                            <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <div>Performance Attribution Chart</div>
                        </div>
                    </div>

                    <!-- Risk Analytics -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Risk Analytics</h3>
                        </div>
                        <div class="chart-container">
                            <i class="fas fa-chart-area" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <div>Risk Decomposition Chart</div>
                        </div>
                    </div>
                </div>

                <!-- Trade Analytics -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Trade Analytics</h3>
                    </div>
                    <div class="grid-4">
                        <div class="metric-card">
                            <div class="metric-value">₹3,450</div>
                            <div class="metric-label">Avg Win</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value negative">-₹1,250</div>
                            <div class="metric-label">Avg Loss</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">2.76</div>
                            <div class="metric-label">Profit Factor</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">68.4%</div>
                            <div class="metric-label">Win Rate</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h1 class="page-title">System Settings</h1>
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" onclick="showSettingsTab('general')">General</button>
                    <button class="tab-btn" onclick="showSettingsTab('trading')">Trading</button>
                    <button class="tab-btn" onclick="showSettingsTab('risk')">Risk</button>
                    <button class="tab-btn" onclick="showSettingsTab('notifications')">Notifications</button>
                </div>

                <!-- General Settings -->
                <div id="general-settings" class="tab-content active">
                    <div class="grid-2">
                        <div class="card">
                            <h4>System Preferences</h4>
                            <div class="form-group">
                                <label>Default Timezone</label>
                                <select>
                                    <option>Asia/Kolkata (IST)</option>
                                    <option>America/New_York (EST)</option>
                                    <option>Europe/London (GMT)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Date Format</label>
                                <select>
                                    <option>DD/MM/YYYY</option>
                                    <option>MM/DD/YYYY</option>
                                    <option>YYYY-MM-DD</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Currency</label>
                                <select>
                                    <option>INR (₹)</option>
                                    <option>USD ($)</option>
                                    <option>EUR (€)</option>
                                </select>
                            </div>
                        </div>

                        <div class="card">
                            <h4>Performance Settings</h4>
                            <div class="form-group">
                                <label>Data Refresh Rate</label>
                                <select>
                                    <option>Real-time</option>
                                    <option>1 second</option>
                                    <option>5 seconds</option>
                                    <option>10 seconds</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Enable advanced charting
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Auto-save strategies
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trading Settings -->
                <div id="trading-settings" class="tab-content">
                    <div class="grid-2">
                        <div class="card">
                            <h4>Execution Settings</h4>
                            <div class="form-group">
                                <label>Default Order Type</label>
                                <select>
                                    <option>Market</option>
                                    <option>Limit</option>
                                    <option>Stop</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Order Timeout (seconds)</label>
                                <input type="number" value="30">
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Confirm orders before execution
                                </label>
                            </div>
                        </div>

                        <div class="card">
                            <h4>Slippage & Commission</h4>
                            <div class="form-group">
                                <label>Default Slippage (%)</label>
                                <input type="number" value="0.05" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Commission per Trade (₹)</label>
                                <input type="number" value="20">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Risk Settings -->
                <div id="risk-settings" class="tab-content">
                    <div class="card">
                        <h4>Risk Management Settings</h4>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Max Portfolio Risk (%)</label>
                                <input type="number" value="5" min="1" max="20">
                            </div>
                            <div class="form-group">
                                <label>Max Position Size (%)</label>
                                <input type="number" value="2" min="0.5" max="10">
                            </div>
                            <div class="form-group">
                                <label>Daily Loss Limit (₹)</label>
                                <input type="number" value="25000">
                            </div>
                            <div class="form-group">
                                <label>Max Drawdown (%)</label>
                                <input type="number" value="15" min="5" max="30">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" checked> Auto-stop on risk limit breach
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox"> Enable portfolio heating cooling
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Notifications Settings -->
                <div id="notifications-settings" class="tab-content">
                    <div class="grid-2">
                        <div class="card">
                            <h4>Alert Preferences</h4>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Email notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox"> SMS notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Browser notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Trading alerts
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Risk alerts
                                </label>
                            </div>
                        </div>

                        <div class="card">
                            <h4>Notification Settings</h4>
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" value="trader@example.com">
                            </div>
                            <div class="form-group">
                                <label>Phone Number</label>
                                <input type="tel" value="+91 9876543210">
                            </div>
                            <div class="form-group">
                                <label>Alert Frequency</label>
                                <select>
                                    <option>Immediate</option>
                                    <option>Every 5 minutes</option>
                                    <option>Every 15 minutes</option>
                                    <option>Hourly</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Container -->
    <div class="notifications" id="notifications"></div>

    <!-- Quick Strategy Modal -->
    <div id="quick-strategy-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('quick-strategy-modal')">&times;</span>
            <h2>Quick Strategy Creator</h2>
            <form onsubmit="createQuickStrategy(event)">
                <div class="form-group">
                    <label>Strategy Name</label>
                    <input type="text" required placeholder="My Quick Strategy">
                </div>
                <div class="form-group">
                    <label>Template</label>
                    <select>
                        <option>Simple Moving Average Crossover</option>
                        <option>RSI Overbought/Oversold</option>
                        <option>Bollinger Band Breakout</option>
                        <option>MACD Signal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Symbol</label>
                    <input type="text" required placeholder="RELIANCE">
                </div>
                <div class="form-group">
                    <label>Timeframe</label>
                    <select>
                        <option>1 minute</option>
                        <option>5 minutes</option>
                        <option>15 minutes</option>
                        <option>1 hour</option>
                        <option>1 day</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Capital Allocation (₹)</label>
                    <input type="number" value="50000" required>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn btn-primary">Create Strategy</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('quick-strategy-modal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global application state
        let currentPage = 'dashboard';
        let tradingMode = 'live'; // 'live' or 'paper'
        let strategies = [
            {
                id: 1,
                name: 'Momentum Pro v2.1',
                status: 'running',
                pnl: 8450,
                trades: 24,
                winRate: 87.5,
                capital: 150000
            },
            {
                id: 2,
                name: 'Mean Reversion Master',
                status: 'paused',
                pnl: -1250,
                trades: 8,
                winRate: 62.5,
                capital: 75000
            },
            {
                id: 3,
                name: 'Arbitrage Hunter',
                status: 'running',
                pnl: 12300,
                trades: 156,
                winRate: 94.2,
                capital: 200000
            }
        ];

        let trades = [
            {
                time: '14:32:15',
                strategy: 'Momentum Pro',
                symbol: 'RELIANCE',
                side: 'BUY',
                quantity: 50,
                price: 2485,
                pnl: 1750,
                status: 'filled'
            },
            {
                time: '14:28:42',
                strategy: 'Arbitrage Hunter',
                symbol: 'TCS',
                side: 'SELL',
                quantity: 25,
                price: 3695,
                pnl: 890,
                status: 'filled'
            }
        ];

        // Paper trading state
        let paperPortfolio = {
            value: 1045680,
            cash: 254320,
            trades: 156,
            winRate: 57.1,
            holdings: [
                { symbol: 'RELIANCE', qty: 50, avgPrice: 2450, current: 2485 },
                { symbol: 'TCS', qty: 25, avgPrice: 3680, current: 3695 },
                { symbol: 'INFY', qty: 40, avgPrice: 1420, current: 1435 }
            ]
        };

        // Market data state
        let marketData = {
            nifty: { price: 19845, change: 125, changePercent: 0.63, support: 19750, resistance: 19950 },
            banknifty: { price: 45280, change: -89, changePercent: -0.20, support: 45000, resistance: 45500 },
            sensex: { price: 66795, change: 234, changePercent: 0.35, support: 66500, resistance: 67200 },
            vix: { price: 14.85, change: -0.45, changePercent: -2.94 }
        };

        // Zerodha API state
        let zerodhaAPI = {
            connected: false,
            apiKey: '',
            apiSecret: '',
            accessToken: '',
            clientId: 'AB1234',
            balance: 345680,
            margin: 123450,
            positions: 8,
            lastSync: new Date()
        };

        // Options chain data
        let optionsChain = [
            {
                strike: 19700,
                call: { oi: 45250, volume: 12340, iv: 16.5, ltp: 85.5, change: 5.25 },
                put: { oi: 89450, volume: 23450, iv: 18.2, ltp: 35.75, change: -2.15 }
            },
            {
                strike: 19800,
                call: { oi: 67890, volume: 34560, iv: 15.8, ltp: 55.25, change: 3.75 },
                put: { oi: 156780, volume: 45670, iv: 17.5, ltp: 55.50, change: 1.25 }
            },
            {
                strike: 19850,
                call: { oi: 89340, volume: 56780, iv: 15.2, ltp: 35.75, change: 2.25 },
                put: { oi: 78920, volume: 34560, iv: 16.8, ltp: 75.25, change: 3.50 }
            },
            {
                strike: 19900,
                call: { oi: 123450, volume: 67890, iv: 14.8, ltp: 22.50, change: 1.75 },
                put: { oi: 45670, volume: 23450, iv: 16.2, ltp: 98.75, change: 5.25 }
            },
            {
                strike: 20000,
                call: { oi: 234560, volume: 89340, iv: 14.2, ltp: 8.75, change: 0.50 },
                put: { oi: 23890, volume: 12340, iv: 15.5, ltp: 155.50, change: 8.75 }
            }
        ];

        // Detailed trade log
        let detailedTrades = [
            {
                id: 'TXN001456',
                date: '28-Dec-2024',
                symbol: 'RELIANCE',
                type: 'Equity',
                side: 'BUY',
                quantity: 50,
                entryTime: '09:32:15',
                entryPrice: 2450.00,
                exitTime: '14:56:23',
                exitPrice: 2485.50,
                pnl: 1775,
                pnlPercent: 1.45,
                strategy: 'Momentum Pro',
                commission: 40,
                netPnl: 1735
            },
            {
                id: 'TXN001455',
                date: '28-Dec-2024',
                symbol: 'TCS',
                type: 'Equity',
                side: 'SELL',
                quantity: 25,
                entryTime: '10:15:42',
                entryPrice: 3695.75,
                exitTime: '15:23:18',
                exitPrice: 3680.25,
                pnl: -387.50,
                pnlPercent: -0.42,
                strategy: 'Mean Reversion',
                commission: 40,
                netPnl: -427.50
            }
        ];

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            renderStrategies();
            renderTrades();
            startRealTimeUpdates();
            initializeMarketData();
            renderOptionsChain();
            renderDetailedTradeLog();
            renderEnhancedWatchlist();
            updateMarketStatus();
        });

        function initializeApp() {
            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle i').className = 'fas fa-sun';
            }

            // Check trading mode
            const savedMode = localStorage.getItem('tradingMode');
            if (savedMode) {
                tradingMode = savedMode;
            }

            // Initialize paper trading mode listeners
            document.getElementById('paper-order-type')?.addEventListener('change', function() {
                const priceGroup = document.getElementById('paper-price-group');
                if (this.value === 'limit' || this.value === 'sl') {
                    priceGroup.style.display = 'block';
                } else {
                    priceGroup.style.display = 'none';
                }
            });

            // Show welcome notification
            showNotification('AlgoTrade Pro with Advanced Features loaded successfully!', 'success');
        }

        // Market Data Functions
        function updateMarketStatus() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const currentTime = hour * 60 + minute;
            
            const marketOpen = 9 * 60 + 15; // 9:15 AM
            const marketClose = 15 * 60 + 30; // 3:30 PM
            
            const statusElement = document.getElementById('market-status');
            if (currentTime >= marketOpen && currentTime <= marketClose) {
                statusElement.textContent = 'MARKET OPEN';
                statusElement.className = 'status running pulse';
            } else {
                statusElement.textContent = 'MARKET CLOSED';
                statusElement.className = 'status stopped';
            }
        }

        function updateTechnicalLevels() {
            const symbol = document.getElementById('technical-symbol').value;
            const levelsTable = document.getElementById('levels-table');
            const trendStatus = document.getElementById('trend-status');
            
            // Simulate different levels for different symbols
            let levels = [];
            let trend = 'BULLISH';
            
            switch(symbol) {
                case 'NIFTY':
                    levels = [
                        { level: 'R3', value: 20150, type: 'Strong Resistance' },
                        { level: 'R2', value: 19950, type: 'Resistance' },
                        { level: 'R1', value: 19900, type: 'Minor Resistance' },
                        { level: 'CMP', value: 19845, type: 'Current Price' },
                        { level: 'S1', value: 19750, type: 'Minor Support' },
                        { level: 'S2', value: 19650, type: 'Support' },
                        { level: 'S3', value: 19500, type: 'Strong Support' }
                    ];
                    break;
                case 'BANKNIFTY':
                    levels = [
                        { level: 'R3', value: 45800, type: 'Strong Resistance' },
                        { level: 'R2', value: 45500, type: 'Resistance' },
                        { level: 'R1', value: 45350, type: 'Minor Resistance' },
                        { level: 'CMP', value: 45280, type: 'Current Price' },
                        { level: 'S1', value: 45000, type: 'Minor Support' },
                        { level: 'S2', value: 44750, type: 'Support' },
                        { level: 'S3', value: 44500, type: 'Strong Support' }
                    ];
                    trend = 'BEARISH';
                    break;
                case 'SENSEX':
                    levels = [
                        { level: 'R3', value: 67500, type: 'Strong Resistance' },
                        { level: 'R2', value: 67200, type: 'Resistance' },
                        { level: 'R1', value: 67000, type: 'Minor Resistance' },
                        { level: 'CMP', value: 66795, type: 'Current Price' },
                        { level: 'S1', value: 66500, type: 'Minor Support' },
                        { level: 'S2', value: 66200, type: 'Support' },
                        { level: 'S3', value: 66000, type: 'Strong Support' }
                    ];
                    break;
            }
            
            trendStatus.textContent = trend;
            trendStatus.className = trend === 'BULLISH' ? 'status running' : 'status stopped';
            
            levelsTable.innerHTML = levels.map(level => {
                const colorClass = level.type.includes('Resistance') ? 'var(--danger-color)' : 
                                 level.type.includes('Support') ? 'var(--success-color)' : 
                                 'var(--primary-color)';
                
                const bgColor = level.level === 'CMP' ? 'rgba(6, 214, 160, 0.1)' : '';
                
                return `
                    <tr style="background: ${bgColor};">
                        <td>${level.level === 'CMP' ? '<strong>CMP</strong>' : level.level}</td>
                        <td>${level.level === 'CMP' ? '<strong>' + level.value + '</strong>' : level.value}</td>
                        <td><span style="color: ${colorClass};">${level.type}</span></td>
                    </tr>
                `;
            }).join('');
        }

        function updateMarketChart(timeframe) {
            // Update chart timeframe buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            showNotification(`Market chart updated to ${timeframe} timeframe`, 'success');
        }

        function renderEnhancedWatchlist() {
            const container = document.getElementById('enhanced-watchlist-table');
            if (!container) return;

            const watchlist = [
                { symbol: 'RELIANCE', ltp: 2485, change: 35, volume: 2500000, rsi: 68, support: 2450, resistance: 2520, signal: 'BUY' },
                { symbol: 'TCS', ltp: 3695, change: 15, volume: 1800000, rsi: 45, support: 3650, resistance: 3720, signal: 'HOLD' },
                { symbol: 'INFY', ltp: 1435, change: -12, volume: 3200000, rsi: 72, support: 1420, resistance: 1450, signal: 'SELL' },
                { symbol: 'HDFC BANK', ltp: 1680, change: -8, volume: 2100000, rsi: 38, support: 1650, resistance: 1695, signal: 'BUY' },
                { symbol: 'ICICI BANK', ltp: 985, change: 12, volume: 4500000, rsi: 55, support: 970, resistance: 1000, signal: 'HOLD' }
            ];

            container.innerHTML = watchlist.map(item => `
                <tr>
                    <td><strong>${item.symbol}</strong></td>
                    <td>₹${item.ltp}</td>
                    <td class="${item.change >= 0 ? 'positive' : 'negative'}">${item.change >= 0 ? '+' : ''}₹${item.change}</td>
                    <td>${(item.volume / 1000000).toFixed(1)}M</td>
                    <td>${item.rsi}</td>
                    <td>₹${item.support}</td>
                    <td>₹${item.resistance}</td>
                    <td><span class="status ${item.signal === 'BUY' ? 'running' : item.signal === 'SELL' ? 'stopped' : 'paused'}">${item.signal}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="quickTrade('${item.symbol}')">Trade</button>
                        <button class="btn btn-sm btn-secondary" onclick="addAlert('${item.symbol}')">Alert</button>
                    </td>
                </tr>
            `).join('');
        }

        function addSymbolToWatchlist() {
            const input = document.getElementById('add-symbol-input');
            const symbol = input.value.trim().toUpperCase();
            
            if (symbol) {
                showNotification(`${symbol} added to watchlist`, 'success');
                input.value = '';
                renderEnhancedWatchlist();
            }
        }

        // Paper Trading Functions
        function placePaperTrade(side) {
            const symbol = document.getElementById('paper-symbol').value.trim().toUpperCase();
            const quantity = parseInt(document.getElementById('paper-quantity').value);
            const orderType = document.getElementById('paper-order-type').value;
            const price = parseFloat(document.getElementById('paper-price').value) || 0;

            if (!symbol || quantity <= 0) {
                showNotification('Please enter valid symbol and quantity', 'error');
                return;
            }

            // Simulate order placement
            const currentPrice = Math.floor(Math.random() * 1000) + 1000; // Random price for demo
            const executionPrice = orderType === 'market' ? currentPrice : price;
            
            showNotification(`📊 Paper ${side} order placed for ${quantity} ${symbol} at ₹${executionPrice}`, 'success');
            
            // Update paper portfolio
            paperPortfolio.trades++;
            const tradeValue = quantity * executionPrice;
            
            if (side === 'BUY') {
                paperPortfolio.cash -= tradeValue;
                // Add to holdings
                const existingHolding = paperPortfolio.holdings.find(h => h.symbol === symbol);
                if (existingHolding) {
                    const totalQty = existingHolding.qty + quantity;
                    existingHolding.avgPrice = ((existingHolding.avgPrice * existingHolding.qty) + tradeValue) / totalQty;
                    existingHolding.qty = totalQty;
                } else {
                    paperPortfolio.holdings.push({
                        symbol: symbol,
                        qty: quantity,
                        avgPrice: executionPrice,
                        current: executionPrice
                    });
                }
            } else {
                paperPortfolio.cash += tradeValue;
                // Remove from holdings
                const existingHolding = paperPortfolio.holdings.find(h => h.symbol === symbol);
                if (existingHolding) {
                    existingHolding.qty -= quantity;
                    if (existingHolding.qty <= 0) {
                        paperPortfolio.holdings = paperPortfolio.holdings.filter(h => h.symbol !== symbol);
                    }
                }
            }
            
            updatePaperPortfolioDisplay();
            renderPaperHoldings();
            
            // Clear form
            document.getElementById('paper-symbol').value = '';
            document.getElementById('paper-quantity').value = '1';
        }

        function updatePaperPortfolioDisplay() {
            document.getElementById('paper-portfolio-value').textContent = `₹${paperPortfolio.value.toLocaleString()}`;
            document.getElementById('paper-trades-count').textContent = paperPortfolio.trades;
            document.getElementById('paper-available-cash').textContent = `₹${paperPortfolio.cash.toLocaleString()}`;
            document.getElementById('paper-win-rate').textContent = `${paperPortfolio.winRate}%`;
        }

        function renderPaperHoldings() {
            const container = document.getElementById('paper-holdings-table');
            if (!container) return;

            container.innerHTML = paperPortfolio.holdings.map(holding => {
                const pnl = (holding.current - holding.avgPrice) * holding.qty;
                return `
                    <tr>
                        <td><strong>${holding.symbol}</strong></td>
                        <td>${holding.qty}</td>
                        <td>₹${holding.avgPrice}</td>
                        <td>₹${holding.current}</td>
                        <td class="${pnl >= 0 ? 'positive' : 'negative'}">${pnl >= 0 ? '+' : ''}₹${Math.abs(pnl).toFixed(0)}</td>
                    </tr>
                `;
            }).join('');
        }

        function resetPaperAccount() {
            if (confirm('Are you sure you want to reset your paper trading account? This will clear all positions and reset to ₹10,00,000.')) {
                paperPortfolio = {
                    value: 1000000,
                    cash: 1000000,
                    trades: 0,
                    winRate: 0,
                    holdings: []
                };
                updatePaperPortfolioDisplay();
                renderPaperHoldings();
                showNotification('📊 Paper trading account reset successfully!', 'success');
            }
        }

        function updatePaperChart(timeframe) {
            // Update chart timeframe buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            showNotification(`Paper trading chart updated to ${timeframe} view`, 'success');
        }

        // Options Trading Functions
        function showOptionsTab(tabName) {
            document.querySelectorAll('#options-trading .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#options-trading .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('options-' + tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function renderOptionsChain() {
            const container = document.getElementById('options-chain-table');
            if (!container) return;

            container.innerHTML = optionsChain.map(option => `
                <tr style="${option.strike === 19850 ? 'background: rgba(6, 214, 160, 0.1);' : ''}">
                    <td>${option.call.oi.toLocaleString()}</td>
                    <td class="${option.call.change >= 0 ? 'positive' : 'negative'}">${option.call.change >= 0 ? '+' : ''}${option.call.oi > 100000 ? Math.floor(option.call.oi / 1000) + 'K' : option.call.oi}</td>
                    <td>${(option.call.volume / 1000).toFixed(0)}K</td>
                    <td>${option.call.iv}%</td>
                    <td>₹${option.call.ltp}</td>
                    <td class="${option.call.change >= 0 ? 'positive' : 'negative'}">${option.call.change >= 0 ? '+' : ''}₹${option.call.change}</td>
                    <td style="background: var(--light-bg); font-weight: bold; text-align: center;">${option.strike}</td>
                    <td class="${option.put.change >= 0 ? 'positive' : 'negative'}">${option.put.change >= 0 ? '+' : ''}₹${option.put.change}</td>
                    <td>₹${option.put.ltp}</td>
                    <td>${option.put.iv}%</td>
                    <td>${(option.put.volume / 1000).toFixed(0)}K</td>
                    <td class="${option.put.change >= 0 ? 'positive' : 'negative'}">${option.put.change >= 0 ? '+' : ''}${option.put.oi > 100000 ? Math.floor(option.put.oi / 1000) + 'K' : option.put.oi}</td>
                    <td>${option.put.oi.toLocaleString()}</td>
                </tr>
            `).join('');
        }

        function updateOptionsChain() {
            const expiry = document.getElementById('options-expiry').value;
            showNotification(`Options chain updated for ${expiry} expiry`, 'success');
            // Simulate different data for different expiries
            renderOptionsChain();
        }

        function createStrategy(strategyType) {
            showNotification(`Creating ${strategyType} options strategy...`, 'warning');
            setTimeout(() => {
                showNotification(`${strategyType} strategy created successfully!`, 'success');
            }, 2000);
        }

        function showOptionStrategy() {
            showNotification('Options strategy builder would open here', 'success');
        }

        function updateOptionsScanner() {
            const filter = document.getElementById('scanner-filter').value;
            showNotification(`Options scanner updated with ${filter} filter`, 'success');
        }

        // Trade Reports Functions
        function renderDetailedTradeLog() {
            const container = document.getElementById('detailed-trade-log');
            if (!container) return;

            container.innerHTML = detailedTrades.map(trade => `
                <tr>
                    <td>${trade.id}</td>
                    <td>${trade.date}</td>
                    <td><strong>${trade.symbol}</strong></td>
                    <td>${trade.type}</td>
                    <td><span class="status ${trade.side === 'BUY' ? 'running' : 'stopped'}">${trade.side}</span></td>
                    <td>${trade.quantity}</td>
                    <td>${trade.entryTime}</td>
                    <td>₹${trade.entryPrice.toFixed(2)}</td>
                    <td>${trade.exitTime}</td>
                    <td>₹${trade.exitPrice.toFixed(2)}</td>
                    <td class="${trade.pnl >= 0 ? 'positive' : 'negative'}">${trade.pnl >= 0 ? '+' : ''}₹${trade.pnl}</td>
                    <td class="${trade.pnlPercent >= 0 ? 'positive' : 'negative'}">${trade.pnlPercent >= 0 ? '+' : ''}${trade.pnlPercent}%</td>
                    <td>${trade.strategy}</td>
                    <td>₹${trade.commission}</td>
                    <td class="${trade.netPnl >= 0 ? 'positive' : 'negative'}">${trade.netPnl >= 0 ? '+' : ''}₹${trade.netPnl}</td>
                </tr>
            `).join('');
        }

        function filterTrades() {
            const dateFilter = document.getElementById('trade-date-filter').value;
            const typeFilter = document.getElementById('trade-type-filter').value;
            const strategyFilter = document.getElementById('trade-strategy-filter').value;
            const symbolFilter = document.getElementById('trade-symbol-filter').value.toUpperCase();

            showNotification(`Trades filtered by: ${dateFilter}, ${typeFilter}, ${strategyFilter}${symbolFilter ? ', ' + symbolFilter : ''}`, 'success');
            
            // Simulate filtering
            renderDetailedTradeLog();
        }

        function exportTradeReport() {
            const data = {
                trades: detailedTrades,
                summary: {
                    totalTrades: detailedTrades.length,
                    totalPnl: detailedTrades.reduce((sum, trade) => sum + trade.netPnl, 0),
                    winRate: (detailedTrades.filter(trade => trade.netPnl > 0).length / detailedTrades.length * 100).toFixed(1)
                },
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trade_report_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Trade report exported successfully!', 'success');
        }

        function generateTaxReport() {
            showNotification('Generating comprehensive tax report...', 'warning');
            setTimeout(() => {
                showNotification('Tax report generated with STCG, LTCG, and loss details!', 'success');
            }, 3000);
        }

        // Broker Integration Functions
        function showBrokerTab(tabName) {
            document.querySelectorAll('#broker-integration .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#broker-integration .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('broker-' + tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function connectZerodha() {
            const apiKey = document.getElementById('zerodha-api-key').value;
            const apiSecret = document.getElementById('zerodha-api-secret').value;
            const requestToken = document.getElementById('zerodha-request-token').value;

            if (!apiKey || !apiSecret) {
                showNotification('Please enter API Key and Secret', 'error');
                return;
            }

            showNotification('Connecting to Zerodha Kite API...', 'warning');
            
            // Simulate API connection
            setTimeout(() => {
                zerodhaAPI.connected = true;
                zerodhaAPI.apiKey = apiKey;
                zerodhaAPI.apiSecret = apiSecret;
                zerodhaAPI.lastSync = new Date();
                
                document.getElementById('zerodha-status').textContent = 'CONNECTED';
                document.getElementById('zerodha-status').className = 'status running';
                
                showNotification('Zerodha API connected successfully!', 'success');
                updateZerodhaDisplay();
            }, 3000);
        }

        function testZerodhaConnection() {
            if (!zerodhaAPI.connected) {
                showNotification('Please connect to Zerodha first', 'error');
                return;
            }

            showNotification('Testing Zerodha API connection...', 'warning');
            
            setTimeout(() => {
                const success = Math.random() > 0.1; // 90% success rate
                if (success) {
                    showNotification('API connection test successful!', 'success');
                } else {
                    showNotification('API connection test failed. Please check credentials.', 'error');
                }
            }, 2000);
        }

        function syncZerodhaData() {
            if (!zerodhaAPI.connected) {
                showNotification('Please connect to Zerodha first', 'error');
                return;
            }

            showNotification('Syncing portfolio data from Zerodha...', 'warning');
            
            setTimeout(() => {
                zerodhaAPI.lastSync = new Date();
                zerodhaAPI.balance = Math.floor(Math.random() * 100000) + 300000;
                zerodhaAPI.margin = Math.floor(Math.random() * 50000) + 100000;
                zerodhaAPI.positions = Math.floor(Math.random() * 10) + 5;
                
                updateZerodhaDisplay();
                showNotification('Portfolio data synced successfully!', 'success');
            }, 2500);
        }

        function updateZerodhaDisplay() {
            document.getElementById('zerodha-balance').textContent = `₹${zerodhaAPI.balance.toLocaleString()}`;
            document.getElementById('zerodha-margin').textContent = `₹${zerodhaAPI.margin.toLocaleString()}`;
            document.getElementById('zerodha-positions').textContent = zerodhaAPI.positions;
            document.getElementById('zerodha-last-sync').textContent = getTimeAgo(zerodhaAPI.lastSync);
        }

        function forcePortfolioSync() {
            showNotification('Force syncing all broker data...', 'warning');
            setTimeout(() => {
                showNotification('All portfolio data synchronized successfully!', 'success');
            }, 3000);
        }

        function addNewBroker() {
            showNotification('Add broker form would open here', 'success');
        }

        // Utility Functions
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min${diffMins > 1 ? 's' : ''} ago`;
            
            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            
            const diffDays = Math.floor(diffHours / 24);
            return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
        }

        // Real-time market data updates
        function startMarketDataUpdates() {
            setInterval(() => {
                updateRealTimeMarketData();
            }, 2000); // Update every 2 seconds during market hours
        }

        function updateRealTimeMarketData() {
            // Update NIFTY
            const niftyChange = (Math.random() - 0.5) * 10;
            marketData.nifty.price += niftyChange;
            marketData.nifty.change += niftyChange;
            marketData.nifty.changePercent = (marketData.nifty.change / (marketData.nifty.price - marketData.nifty.change)) * 100;
            
            // Update Bank NIFTY
            const bankNiftyChange = (Math.random() - 0.5) * 25;
            marketData.banknifty.price += bankNiftyChange;
            marketData.banknifty.change += bankNiftyChange;
            marketData.banknifty.changePercent = (marketData.banknifty.change / (marketData.banknifty.price - marketData.banknifty.change)) * 100;
            
            // Update SENSEX
            const sensexChange = (Math.random() - 0.5) * 30;
            marketData.sensex.price += sensexChange;
            marketData.sensex.change += sensexChange;
            marketData.sensex.changePercent = (marketData.sensex.change / (marketData.sensex.price - marketData.sensex.change)) * 100;
            
            // Update VIX
            const vixChange = (Math.random() - 0.5) * 0.5;
            marketData.vix.price += vixChange;
            marketData.vix.change += vixChange;
            marketData.vix.changePercent = (marketData.vix.change / (marketData.vix.price - marketData.vix.change)) * 100;
            
            // Update display
            updateMarketDataDisplay();
        }

        function updateMarketDataDisplay() {
            // Update NIFTY
            const niftyPrice = document.getElementById('nifty-price');
            const niftyChange = document.getElementById('nifty-change');
            if (niftyPrice && niftyChange) {
                niftyPrice.textContent = Math.round(marketData.nifty.price);
                niftyPrice.className = `metric-value ${marketData.nifty.change >= 0 ? 'positive' : 'negative'}`;
                niftyChange.textContent = `${marketData.nifty.change >= 0 ? '+' : ''}${Math.round(marketData.nifty.change)} (${marketData.nifty.changePercent >= 0 ? '+' : ''}${marketData.nifty.changePercent.toFixed(2)}%)`;
                niftyChange.className = `metric-change ${marketData.nifty.change >= 0 ? 'positive' : 'negative'}`;
            }
            
            // Update Bank NIFTY
            const bankNiftyPrice = document.getElementById('banknifty-price');
            const bankNiftyChange = document.getElementById('banknifty-change');
            if (bankNiftyPrice && bankNiftyChange) {
                bankNiftyPrice.textContent = Math.round(marketData.banknifty.price);
                bankNiftyPrice.className = `metric-value ${marketData.banknifty.change >= 0 ? 'positive' : 'negative'}`;
                bankNiftyChange.textContent = `${marketData.banknifty.change >= 0 ? '+' : ''}${Math.round(marketData.banknifty.change)} (${marketData.banknifty.changePercent >= 0 ? '+' : ''}${marketData.banknifty.changePercent.toFixed(2)}%)`;
                bankNiftyChange.className = `metric-change ${marketData.banknifty.change >= 0 ? 'positive' : 'negative'}`;
            }
            
            // Update SENSEX
            const sensexPrice = document.getElementById('sensex-price');
            const sensexChange = document.getElementById('sensex-change');
            if (sensexPrice && sensexChange) {
                sensexPrice.textContent = Math.round(marketData.sensex.price);
                sensexPrice.className = `metric-value ${marketData.sensex.change >= 0 ? 'positive' : 'negative'}`;
                sensexChange.textContent = `${marketData.sensex.change >= 0 ? '+' : ''}${Math.round(marketData.sensex.change)} (${marketData.sensex.changePercent >= 0 ? '+' : ''}${marketData.sensex.changePercent.toFixed(2)}%)`;
                sensexChange.className = `metric-change ${marketData.sensex.change >= 0 ? 'positive' : 'negative'}`;
            }
            
            // Update VIX
            const vixValue = document.getElementById('vix-value');
            const vixChange = document.getElementById('vix-change');
            if (vixValue && vixChange) {
                vixValue.textContent = marketData.vix.price.toFixed(2);
                vixChange.textContent = `${marketData.vix.change >= 0 ? '+' : ''}${marketData.vix.change.toFixed(2)} (${marketData.vix.changePercent >= 0 ? '+' : ''}${marketData.vix.changePercent.toFixed(2)}%)`;
                vixChange.className = `metric-change ${marketData.vix.change >= 0 ? 'positive' : 'negative'}`;
            }
        }

        // Start all real-time updates
        function startRealTimeUpdates() {
            setInterval(() => {
                updateRealTimeData();
                if (currentPage === 'market-data') {
                    startMarketDataUpdates();
                }
                updateMarketStatus();
            }, 5000); // Update every 5 seconds
            
            // Start market data updates immediately if on market-data page
            if (currentPage === 'market-data') {
                startMarketDataUpdates();
            }
        }

        // Navigation functions
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            event.target.closest('.nav-link').classList.add('active');
            
            currentPage = pageId;
            
            // Page-specific initialization
            if (pageId === 'live-trading') {
                initializeLiveTrading();
            } else if (pageId === 'market-data') {
                initializeMarketData();
            }
        }

        // Strategy management
        function renderStrategies() {
            const container = document.getElementById('strategies-list');
            if (!container) return;

            container.innerHTML = strategies.map(strategy => `
                <div style="display: flex; justify-content: between; align-items: center; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 10px;">
                    <div style="flex: 1;">
                        <h5 style="margin: 0; color: var(--text-dark);">${strategy.name}</h5>
                        <div style="display: flex; gap: 15px; margin-top: 5px; font-size: 0.9rem; color: var(--text-light);">
                            <span>P&L: <strong class="${strategy.pnl >= 0 ? 'positive' : 'negative'}">₹${strategy.pnl.toLocaleString()}</strong></span>
                            <span>Trades: ${strategy.trades}</span>
                            <span>Win Rate: ${strategy.winRate}%</span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span class="status ${strategy.status}">${strategy.status.toUpperCase()}</span>
                        <button class="btn btn-sm btn-secondary" onclick="toggleStrategy(${strategy.id})">
                            <i class="fas fa-${strategy.status === 'running' ? 'pause' : 'play'}"></i>
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="editStrategy(${strategy.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderTrades() {
            const container = document.getElementById('recent-trades');
            if (!container) return;

            container.innerHTML = trades.map(trade => `
                <tr>
                    <td>${trade.time}</td>
                    <td>${trade.strategy}</td>
                    <td><strong>${trade.symbol}</strong></td>
                    <td><span class="status ${trade.side.toLowerCase() === 'buy' ? 'running' : 'stopped'}">${trade.side}</span></td>
                    <td>${trade.quantity}</td>
                    <td>₹${trade.price}</td>
                    <td class="${trade.pnl >= 0 ? 'positive' : 'negative'}">₹${trade.pnl}</td>
                    <td><span class="status running">${trade.status}</span></td>
                </tr>
            `).join('');
        }

        // Live trading functions
        function initializeLiveTrading() {
            renderLiveStrategies();
            renderActiveOrders();
            renderOpenPositions();
        }

        function renderLiveStrategies() {
            const container = document.getElementById('live-strategies');
            if (!container) return;

            container.innerHTML = strategies.filter(s => s.status === 'running').map(strategy => `
                <div style="padding: 10px; border-left: 3px solid var(--success-color); background: rgba(16, 185, 129, 0.05); margin-bottom: 10px; border-radius: 5px;">
                    <div style="font-weight: 600;">${strategy.name}</div>
                    <div style="font-size: 0.9rem; color: var(--text-light);">P&L: ₹${strategy.pnl} | Trades: ${strategy.trades}</div>
                </div>
            `).join('');
        }

        function renderActiveOrders() {
            const container = document.getElementById('active-orders');
            if (!container) return;

            const orders = [
                { symbol: 'RELIANCE', side: 'BUY', qty: 50, price: 2480, status: 'pending' },
                { symbol: 'TCS', side: 'SELL', qty: 25, price: 3700, status: 'partial' }
            ];

            container.innerHTML = orders.map(order => `
                <tr>
                    <td><strong>${order.symbol}</strong></td>
                    <td><span class="status ${order.side.toLowerCase() === 'buy' ? 'running' : 'stopped'}">${order.side}</span></td>
                    <td>${order.qty}</td>
                    <td>₹${order.price}</td>
                    <td><span class="status ${order.status === 'pending' ? 'paused' : 'running'}">${order.status}</span></td>
                </tr>
            `).join('');
        }

        function renderOpenPositions() {
            const container = document.getElementById('open-positions');
            if (!container) return;

            const positions = [
                { symbol: 'RELIANCE', qty: 100, avgPrice: 2450, current: 2485, pnl: 3500 },
                { symbol: 'TCS', qty: 50, avgPrice: 3680, current: 3695, pnl: 750 },
                { symbol: 'INFY', qty: 75, avgPrice: 1420, current: 1435, pnl: 1125 }
            ];

            container.innerHTML = positions.map(pos => `
                <tr>
                    <td><strong>${pos.symbol}</strong></td>
                    <td>${pos.qty}</td>
                    <td>₹${pos.avgPrice}</td>
                    <td>₹${pos.current}</td>
                    <td class="${pos.pnl >= 0 ? 'positive' : 'negative'}">₹${pos.pnl}</td>
                </tr>
            `).join('');
        }

        // Market data functions
        function initializeMarketData() {
            renderWatchlist();
            startMarketDataUpdates();
        }

        function renderWatchlist() {
            const container = document.getElementById('watchlist-table');
            if (!container) return;

            const watchlist = [
                { symbol: 'RELIANCE', ltp: 2485, change: 35, volume: 2500000, rsi: 68, macd: 'Bullish', signal: 'BUY' },
                { symbol: 'TCS', ltp: 3695, change: 15, volume: 1800000, rsi: 45, macd: 'Neutral', signal: 'HOLD' },
                { symbol: 'INFY', ltp: 1435, change: -12, volume: 3200000, rsi: 72, macd: 'Bearish', signal: 'SELL' },
                { symbol: 'HDFC BANK', ltp: 1680, change: -8, volume: 2100000, rsi: 38, macd: 'Bullish', signal: 'BUY' }
            ];

            container.innerHTML = watchlist.map(item => `
                <tr>
                    <td><strong>${item.symbol}</strong></td>
                    <td>₹${item.ltp}</td>
                    <td class="${item.change >= 0 ? 'positive' : 'negative'}">${item.change >= 0 ? '+' : ''}₹${item.change}</td>
                    <td>${(item.volume / 1000000).toFixed(1)}M</td>
                    <td>${item.rsi}</td>
                    <td>${item.macd}</td>
                    <td><span class="status ${item.signal === 'BUY' ? 'running' : item.signal === 'SELL' ? 'stopped' : 'paused'}">${item.signal}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="quickTrade('${item.symbol}')">Trade</button>
                        <button class="btn btn-sm btn-secondary" onclick="addAlert('${item.symbol}')">Alert</button>
                    </td>
                </tr>
            `).join('');
        }

        // Strategy functions
        function toggleStrategy(strategyId) {
            const strategy = strategies.find(s => s.id === strategyId);
            if (!strategy) return;

            strategy.status = strategy.status === 'running' ? 'paused' : 'running';
            renderStrategies();
            showNotification(`Strategy ${strategy.name} ${strategy.status}`, 'success');
        }

        function editStrategy(strategyId) {
            showNotification(`Opening strategy editor for ID: ${strategyId}`, 'success');
            showPage('strategy-builder');
        }

        function startAllStrategies() {
            strategies.forEach(strategy => {
                strategy.status = 'running';
            });
            renderStrategies();
            showNotification('All strategies started successfully!', 'success');
        }

        function refreshStrategies() {
            // Simulate data refresh
            strategies.forEach(strategy => {
                strategy.pnl += Math.floor(Math.random() * 1000) - 500;
                strategy.trades += Math.floor(Math.random() * 3);
            });
            renderStrategies();
            showNotification('Strategies data refreshed', 'success');
        }

        // Quick strategy creation
        function createQuickStrategy(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const newStrategy = {
                id: strategies.length + 1,
                name: formData.get('strategyName') || 'Quick Strategy',
                status: 'paused',
                pnl: 0,
                trades: 0,
                winRate: 0,
                capital: parseInt(formData.get('capital')) || 50000
            };

            strategies.push(newStrategy);
            renderStrategies();
            closeModal('quick-strategy-modal');
            showNotification(`Strategy "${newStrategy.name}" created successfully!`, 'success');
        }

        // Tab management
        function showBuilderTab(tabName) {
            document.querySelectorAll('#strategy-builder .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#strategy-builder .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName === 'visual' ? 'visual-builder' : tabName === 'code' ? 'code-editor' : 'templates').classList.add('active');
            event.target.classList.add('active');
        }

        function showResearchTab(tabName) {
            document.querySelectorAll('#research .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#research .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showSettingsTab(tabName) {
            document.querySelectorAll('#settings .tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#settings .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + '-settings').classList.add('active');
            event.target.classList.add('active');
        }

        // Strategy builder functions
        function loadTemplate() {
            showNotification('Loading strategy template...', 'success');
        }

        function saveStrategy() {
            showNotification('Strategy saved successfully!', 'success');
        }

        function loadStrategyTemplate(templateType) {
            showNotification(`Loading ${templateType} template...`, 'success');
            // Switch to visual builder
            document.getElementById('visual-builder').classList.add('active');
            document.getElementById('code-editor').classList.remove('active');
            document.getElementById('templates').classList.remove('active');
        }

        // Backtesting functions
        function runBacktest() {
            showNotification('Starting backtest...', 'warning');
            
            // Simulate backtest progress
            setTimeout(() => {
                showNotification('Backtest completed successfully!', 'success');
                updateBacktestResults();
            }, 3000);
        }

        function updateBacktestResults() {
            // Update backtest metrics with simulated results
            showNotification('Backtest results updated', 'success');
        }

        // Live trading functions
        function emergencyStop() {
            if (confirm('Are you sure you want to emergency stop all trading? This will close all positions and cancel all orders.')) {
                strategies.forEach(strategy => {
                    strategy.status = 'stopped';
                });
                renderStrategies();
                renderLiveStrategies();
                showNotification('EMERGENCY STOP ACTIVATED - All trading halted!', 'error');
            }
        }

        // Portfolio functions
        function rebalancePortfolio() {
            showNotification('Portfolio rebalancing initiated...', 'warning');
            setTimeout(() => {
                showNotification('Portfolio rebalanced successfully!', 'success');
            }, 2000);
        }

        // Risk management functions
        function updateRiskLimits() {
            showNotification('Risk limits updated successfully!', 'success');
        }

        // Market data functions
        function addToWatchlist() {
            const symbol = prompt('Enter symbol to add to watchlist:');
            if (symbol) {
                showNotification(`${symbol.toUpperCase()} added to watchlist`, 'success');
                renderWatchlist();
            }
        }

        function quickTrade(symbol) {
            showNotification(`Opening quick trade for ${symbol}`, 'success');
            // Here you would open a quick trade modal
        }

        function addAlert(symbol) {
            showNotification(`Alert created for ${symbol}`, 'success');
        }

        // Research functions
        function createNotebook() {
            showNotification('Creating new research notebook...', 'success');
        }

        // Optimization functions
        function startOptimization() {
            showNotification('Starting strategy optimization...', 'warning');
            
            // Simulate optimization progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                if (progress >= 100) {
                    clearInterval(interval);
                    showNotification('Optimization completed successfully!', 'success');
                } else {
                    showNotification(`Optimization progress: ${progress}%`, 'warning');
                }
            }, 1000);
        }

        // Alerts functions
        function createAlert() {
            showNotification('Alert creation form would open here', 'success');
        }

        // Analytics functions
        function generateReport() {
            showNotification('Generating comprehensive analytics report...', 'warning');
            setTimeout(() => {
                showNotification('Analytics report generated successfully!', 'success');
            }, 2000);
        }

        // Settings functions
        function saveSettings() {
            showNotification('Settings saved successfully!', 'success');
        }

        // Chart functions
        function updateChart(timeframe) {
            // Update chart timeframe buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            showNotification(`Chart updated to ${timeframe} view`, 'success');
        }

        // Real-time updates
        function startRealTimeUpdates() {
            setInterval(() => {
                updateRealTimeData();
            }, 5000); // Update every 5 seconds
        }

        function updateRealTimeData() {
            // Update portfolio metrics
            updatePortfolioMetrics();
            
            // Update market data if on market data page
            if (currentPage === 'market-data') {
                startMarketDataUpdates();
            }
            
            // Update live trading data if on live trading page
            if (currentPage === 'live-trading') {
                updateLiveTradingData();
            }
        }

        function updatePortfolioMetrics() {
            const pnlElement = document.getElementById('total-pnl');
            const activeStrategiesElement = document.getElementById('active-strategies');
            const riskExposureElement = document.getElementById('risk-exposure');
            const winRateElement = document.getElementById('win-rate');

            if (pnlElement) {
                const currentPnl = parseInt(pnlElement.textContent.replace(/[^\d-]/g, ''));
                const change = Math.floor(Math.random() * 1000) - 500;
                const newPnl = currentPnl + change;
                pnlElement.textContent = `${newPnl >= 0 ? '+' : ''}₹${Math.abs(newPnl).toLocaleString()}`;
                pnlElement.className = newPnl >= 0 ? 'metric-value positive' : 'metric-value negative';
            }

            if (activeStrategiesElement) {
                const activeCount = strategies.filter(s => s.status === 'running').length;
                activeStrategiesElement.textContent = activeCount;
            }

            if (riskExposureElement) {
                const risk = Math.floor(Math.random() * 20) + 50;
                riskExposureElement.textContent = `${risk}%`;
            }

            if (winRateElement) {
                const winRate = (Math.random() * 20 + 70).toFixed(1);
                winRateElement.textContent = `${winRate}%`;
            }
        }

        function startMarketDataUpdates() {
            // Simulate real-time market data updates
            const symbols = ['RELIANCE', 'TCS', 'INFY', 'HDFC BANK'];
            symbols.forEach(symbol => {
                // Simulate price changes
                const change = (Math.random() - 0.5) * 50;
                // Update display would go here
            });
        }

        function updateLiveTradingData() {
            // Update live trading metrics
            renderLiveStrategies();
            renderActiveOrders();
            renderOpenPositions();
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Theme functions
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeIcon = document.querySelector('.theme-toggle i');
            
            if (document.body.classList.contains('dark-mode')) {
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
                showNotification('Dark mode activated', 'success');
            } else {
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
                showNotification('Light mode activated', 'success');
            }
        }

        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            const container = document.getElementById('notifications');
            container.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Advanced features
        function enableAdvancedMode() {
            showNotification('Advanced trading mode enabled!', 'success');
        }

        function exportData() {
            showNotification('Exporting trading data...', 'warning');
            setTimeout(() => {
                showNotification('Data exported successfully!', 'success');
            }, 2000);
        }

        function importStrategy() {
            showNotification('Strategy import initiated...', 'warning');
        }

        function connectAPI() {
            showNotification('Connecting to trading API...', 'warning');
            setTimeout(() => {
                showNotification('API connected successfully!', 'success');
            }, 3000);
        }

        // System monitoring
        function checkSystemHealth() {
            const status = document.getElementById('system-status');
            const isHealthy = Math.random() > 0.1; // 90% chance of being healthy
            
            if (isHealthy) {
                status.textContent = 'SYSTEM ONLINE';
                status.className = 'status running pulse';
            } else {
                status.textContent = 'SYSTEM WARNING';
                status.className = 'status paused';
                showNotification('System performance warning detected', 'warning');
            }
        }

        // Performance monitoring
        function monitorPerformance() {
            // Monitor memory usage, API latency, etc.
            const metrics = {
                memoryUsage: Math.floor(Math.random() * 40) + 40, // 40-80%
                apiLatency: Math.floor(Math.random() * 50) + 10,  // 10-60ms
                cpuUsage: Math.floor(Math.random() * 30) + 20     // 20-50%
            };
            
            if (metrics.memoryUsage > 80 || metrics.apiLatency > 100 || metrics.cpuUsage > 80) {
                showNotification('Performance warning: High resource usage detected', 'warning');
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 's':
                        event.preventDefault();
                        saveSettings();
                        break;
                    case 'n':
                        event.preventDefault();
                        if (currentPage === 'strategy-builder') {
                            showModal('quick-strategy-modal');
                        }
                        break;
                    case 'r':
                        event.preventDefault();
                        refreshStrategies();
                        break;
                }
            }
            
            // ESC to close modals
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });

        // Start system monitoring
        setInterval(checkSystemHealth, 30000); // Check every 30 seconds
        setInterval(monitorPerformance, 60000); // Check every minute

        // Initialize drag and drop for strategy builder
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
        });

        function initializeDragAndDrop() {
            const canvas = document.querySelector('.canvas-area');
            const components = document.querySelectorAll('.component-item');
            
            components.forEach(component => {
                component.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', this.textContent);
                });
            });
            
            if (canvas) {
                canvas.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                canvas.addEventListener('drop', function(e) {
                    e.preventDefault();
                    const componentText = e.dataTransfer.getData('text/plain');
                    showNotification(`Added component: ${componentText}`, 'success');
                    
                    // Add visual component to canvas
                    const componentDiv = document.createElement('div');
                    componentDiv.style.cssText = `
                        position: absolute;
                        top: ${e.offsetY}px;
                        left: ${e.offsetX}px;
                        background: var(--primary-color);
                        color: white;
                        padding: 10px 15px;
                        border-radius: 6px;
                        cursor: move;
                        user-select: none;
                    `;
                    componentDiv.textContent = componentText;
                    canvas.appendChild(componentDiv);
                    
                    // Make the component draggable within canvas
                    makeDraggable(componentDiv);
                });
            }
        }

        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            element.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }
            
            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.querySelector('.search-box input');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const query = e.target.value.toLowerCase();
                    if (query.length > 2) {
                        performSearch(query);
                    }
                });
            }
        });

        function performSearch(query) {
            // Search through strategies, symbols, etc.
            const results = strategies.filter(s => 
                s.name.toLowerCase().includes(query)
            );
            
            if (results.length > 0) {
                showNotification(`Found ${results.length} matching strategies`, 'success');
            }
        }

        // Data export functionality
        function exportTradingData() {
            const data = {
                strategies: strategies,
                trades: trades,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trading_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Trading data exported successfully!', 'success');
        }

        // WebSocket simulation for real-time data
        function simulateWebSocket() {
            // Simulate real-time market data feed
            setInterval(() => {
                const symbols = ['NIFTY', 'BANKNIFTY', 'RELIANCE', 'TCS', 'INFY'];
                const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                const randomPrice = Math.floor(Math.random() * 5000) + 1000;
                const randomChange = (Math.random() - 0.5) * 100;
                
                // Emit simulated data event
                const event = new CustomEvent('marketData', {
                    detail: {
                        symbol: randomSymbol,
                        price: randomPrice,
                        change: randomChange
                    }
                });
                document.dispatchEvent(event);
            }, 2000);
        }

        // Listen for market data events
        document.addEventListener('marketData', function(event) {
            const { symbol, price, change } = event.detail;
            // Update UI with new market data
            console.log(`Market Update: ${symbol} - ₹${price} (${change >= 0 ? '+' : ''}${change.toFixed(2)})`);
        });

        // Start WebSocket simulation
        setTimeout(simulateWebSocket, 5000);

        console.log('🚀 AlgoTrade Pro - Complete Algorithmic Trading Platform Loaded Successfully!');
        console.log('Features: Strategy Builder | Backtesting | Live Trading | Portfolio Management | Risk Management | Market Data | Research Lab | Optimization | Alerts | Analytics');
    </script>

<script>
window.addEventListener("DOMContentLoaded", () => {
    fetch("https://alfa-ai-backend.onrender.com/status")
        .then(response => response.json())
        .then(data => {
            console.log("Backend Response:", data);
            const statusEl = document.getElementById("system-status");
            if (statusEl && data.status === "ok") {
                statusEl.textContent = "BACKEND CONNECTED";
                statusEl.classList.add("running");
            }
        })
        .catch(error => {
            console.error("Backend Error:", error);
            const statusEl = document.getElementById("system-status");
            if (statusEl) {
                statusEl.textContent = "BACKEND OFFLINE";
                statusEl.classList.remove("running");
                statusEl.classList.add("stopped");
            }
        });
});
</script>


<div style="margin-top: 20px; color: white;">
    🔁 Signal Output: <span id="signal-box">Loading...</span><br>
    📈 Price Output: <span id="price-box">Loading...</span>
</div>


<script>
window.addEventListener("DOMContentLoaded", () => {
    // Call /get-signal
    fetch("https://alfa-ai-backend.onrender.com/get-signal")
        .then(res => res.json())
        .then(data => {
            console.log("Signal Response:", data);
            const signalBox = document.getElementById("signal-box");
            if (signalBox) signalBox.textContent = JSON.stringify(data);
        })
        .catch(err => console.error("Signal Error:", err));

    // Call /get-price?symbol=WIPRO
    fetch("https://alfa-ai-backend.onrender.com/get-price?symbol=WIPRO")
        .then(res => res.json())
        .then(data => {
            console.log("Price Response:", data);
            const priceBox = document.getElementById("price-box");
            if (priceBox) priceBox.textContent = `WIPRO: ₹${data.price}`;
        })
        .catch(err => console.error("Price Error:", err));
});
</script>

</body>
</html>
